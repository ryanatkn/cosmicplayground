import{n as ye,e as we,x as N,s as ne,b as ke,l as Se,y as K,d as I,c as se,m as ee,i as M,o as xe,A as Re,I as ie,J as ge,a as L,E as F,P as re,G as Ve,L as it,a6 as ut,M as ct,q as ft,g as dt,C as ot,p as qe,r as Ge}from"./scheduler.EKw-xcnK.js";import{S as Te,i as ve,c as X,a as U,m as Z,t as q,b as G,d as J}from"./index.nrQb7by4.js";import{e as He,u as mt,d as ht}from"./each.JsaE_8Dp.js";import{W as _t,A as pe}from"./WaitingAnimation.CPWKKqpl.js";import{w as de}from"./index.mvauKzP3.js";import{U as Fe}from"./error.8yf43-la.js";import{g as gt,C as Be,F as bt,d as pt,a as Je,k as wt}from"./pixi.tNwfo43o.js";import{s as Me}from"./index.QBIbXOVU.js";import{s as kt}from"./dom.z-RU6ZBL.js";import{g as yt}from"./settings.0RiAA-LB.js";import{g as Tt,r as vt,T as je}from"./renderStats.ZCkjnyc1.js";import{t as It}from"./tweened.C790SHtI.js";import{S as xt}from"./Surface2.-qMxk1r0.js";import{r as Qe}from"./maths.K6m04wT8.js";import{g as St}from"./clock.8qoZqBH_.js";import{F as _e}from"./FloatingTextButton.NvWIcJ-1.js";function $e(n,e,t){const s=n.slice();return s[3]=e[t],s}function et(n,e){let t,s,a,r;function i(){return e[2](e[3])}return{key:n,first:null,c(){t=we("div"),this.h()},l(u){t=ke(u,"DIV",{class:!0,"aria-hidden":!0,title:!0}),Se(t).forEach(I),this.h()},h(){ee(t,"class","resource svelte-a77dfn"),ee(t,"aria-hidden",""),ee(t,"title",s=e[3].status==="failure"?"click to reload":e[3].status==="success"?"resource loaded":"resource loading"),ie(t,"success",e[3].status==="success"),ie(t,"pending",e[3].status==="pending"),ie(t,"failure",e[3].status==="failure"),this.first=t},m(u,o){M(u,t,o),a||(r=ge(t,"click",i),a=!0)},p(u,o){e=u,o&2&&s!==(s=e[3].status==="failure"?"click to reload":e[3].status==="success"?"resource loaded":"resource loading")&&ee(t,"title",s),o&2&&ie(t,"success",e[3].status==="success"),o&2&&ie(t,"pending",e[3].status==="pending"),o&2&&ie(t,"failure",e[3].status==="failure")},d(u){u&&I(t),a=!1,r()}}}function Ct(n){let e,t,s=Math.round(n[1].progress*100)+"",a,r,i,u,o=[],m=new Map,c,f,T,p,y=He(n[1].resources);const _=h=>h[3].url;for(let h=0;h<y.length;h+=1){let d=$e(n,y,h),w=_(d);m.set(w,o[h]=et(w,d))}return T=new _t({props:{status:n[1].status}}),{c(){e=we("div"),t=we("h2"),a=N(s),r=N("%"),i=ne(),u=we("div");for(let h=0;h<o.length;h+=1)o[h].c();c=ne(),f=we("div"),X(T.$$.fragment),this.h()},l(h){e=ke(h,"DIV",{class:!0});var d=Se(e);t=ke(d,"H2",{class:!0});var w=Se(t);a=K(w,s),r=K(w,"%"),w.forEach(I),i=se(d),u=ke(d,"DIV",{class:!0});var C=Se(u);for(let P=0;P<o.length;P+=1)o[P].l(C);C.forEach(I),c=se(d),f=ke(d,"DIV",{class:!0});var z=Se(f);U(T.$$.fragment,z),z.forEach(I),d.forEach(I),this.h()},h(){ee(t,"class","svelte-a77dfn"),ee(u,"class","resources svelte-a77dfn"),ee(f,"class","waiting-animation-wrapper svelte-a77dfn"),ee(e,"class","resources-loading-progress svelte-a77dfn")},m(h,d){M(h,e,d),xe(e,t),xe(t,a),xe(t,r),xe(e,i),xe(e,u);for(let w=0;w<o.length;w+=1)o[w]&&o[w].m(u,null);xe(e,c),xe(e,f),Z(T,f,null),p=!0},p(h,[d]){(!p||d&2)&&s!==(s=Math.round(h[1].progress*100)+"")&&Re(a,s),d&2&&(y=He(h[1].resources),o=mt(o,d,_,1,h,y,m,u,ht,et,null,$e));const w={};d&2&&(w.status=h[1].status),T.$set(w)},i(h){p||(q(T.$$.fragment,h),p=!0)},o(h){G(T.$$.fragment,h),p=!1},d(h){h&&I(e);for(let d=0;d<o.length;d+=1)o[d].d();J(T)}}}function Et(n,e,t){let s,a=L,r=()=>(a(),a=F(i,o=>t(1,s=o)),i);n.$$.on_destroy.push(()=>a());let{resources:i}=e;r();const u=o=>{o.status==="failure"&&window.location.reload()};return n.$$set=o=>{"resources"in o&&r(t(0,i=o.resources))},[i,s,u]}class vn extends Te{constructor(e){super(),ve(this,e,Et,Ct,ye,{resources:0})}}const In=()=>{let n,e=null;const t=de({status:"initial",progress:0,resources:[],promise:e}),{update:s,subscribe:a}=t,r=u=>{let o=!1;s(m=>{let c=0;const f=m.resources.map(p=>p.url===u?(c++,{...p,status:"success"}):(p.status==="success"&&c++,p)),T=c/f.length;return T===1&&(o=!0),{...m,progress:T,status:m.status==="failure"?"failure":T===1?"success":"pending",resources:f}}),o&&n()},i=u=>{s(o=>{const m=o.resources.map(c=>c.url===u?{...c,status:"failure"}:c);return{...o,status:"failure",resources:m}}),n()};return{subscribe:a,addResource:(u,o)=>{let m;return s(c=>{if(c.status!=="initial")throw Error(`Cannot add resources after loading: ${o}`);if(c.resources.find(f=>f.url===o))throw Error(`Already added resource ${o}`);switch(u){case"image":{m={type:u,url:o,status:"initial",texture:de(null)};break}case"audio":{m={type:u,url:o,status:"initial",audio:null};break}default:throw new Fe(u)}return{...c,resources:c.resources.concat(m)}}),m},load:()=>e||(e=new Promise(u=>n=u),s(u=>{const o=[];for(const m of u.resources)switch(m.type){case"image":{pe.load(m.url).then(f=>{r(m.url),m.texture.set(f)},()=>i(m.url)),o.push({...m,status:"pending"});break}case"audio":{const c=new Audio;c.addEventListener("canplaythrough",()=>r(m.url),{once:!0}),c.addEventListener("error",()=>i(m.url),{once:!0}),o.push({...m,status:"pending",audio:c});break}default:throw new Fe(m)}return setTimeout(()=>{for(const m of o)switch(m.type){case"image":break;case"audio":{m.audio.src=m.url;break}default:throw new Fe(m)}}),{...u,status:"pending",resources:o,promise:e}}),e)}},xn=(n,e)=>{const t=n.steps.find(s=>"name"in s&&s.name===e);if(!t)throw Error(`Failed to find tour step with name ${e}`);return t},Pe=(n,e,t=n.length-1)=>{for(let s=t;s>=0;s--){const a=n[s];if(a.type===e)return a}},Sn=(n,e,t,s,a)=>{const r=t-e.startTime,i=n.duration*1e3;r>=0&&r<i?(n.currentTime=r/1e3,a?n.paused||n.pause():n.paused&&s&&n.play()):n.paused||n.pause()},Cn=()=>{let n=0,e=0;const t=[],s=()=>({steps:t,totalDuration:e}),a=new Map,r=_=>{const h={..._,startTime:n+_.startTime,index:t.length},d=a.get(h.type);if(d&&d.startTime+d.duration>h.startTime)throw console.error("Conflicting step",h),Error(`Cannot add conflicting step with type ${h.type} with currentTime ${n} at transform ${t.length}`);t.push(h),a.set(h.type,h),e=Math.max(e,h.startTime+h.duration)},i=_=>{_===void 0?n=e:n+=_},u=(_,h,d,w=Me)=>{r({type:"pan",startTime:0,index:-1,x:_,y:h,duration:d,easing:w})},o=(_,h,d=Me)=>{r({type:"zoom",startTime:0,index:-1,scale:_,duration:h,easing:d})},m=(_,h,d,w=Me)=>{const C=Pe(t,"pan");if(!C)throw Error("Cannot call 'panBy' before at least one 'pan' step.");u(C.x+_,C.y+h,d,w)},c=(_,h,d=Me)=>{const w=Pe(t,"zoom");if(!w)throw Error("Cannot call 'zoomBy' before at least one 'zoom' step.");o(w.scale*_,h,d)},f=new Set;let T=0;return{wait:i,pan:u,zoom:o,panBy:m,zoomBy:c,event:(_,h)=>{r({type:"event",startTime:0,index:-1,duration:0,name:_,data:h});const d=++T;return()=>{if(f.has(d))throw Error(`Already waited for event '${_}' with id ${d}`);r({type:"waitForEvent",startTime:0,index:-1,duration:0,name:_}),f.add(d)}},finalize:s,get_time_diff:()=>e-n}};function Dt(n,e,t){let s,a=L,r=()=>(a(),a=F(m,w=>t(9,s=w)),m),i,u=L,o=()=>(u(),u=F(f,w=>t(6,i=w)),f);n.$$.on_destroy.push(()=>a()),n.$$.on_destroy.push(()=>u());let{value:m}=e;r();let{enabled:c=!0}=e,f,T,p,y=c;const _=w=>{f&&(w?f.set(T,{duration:p}):f.set(i,{duration:0}))},h=(w,C,z=Me)=>(f||o(t(1,f=It(s))),T=w,p=C,f.set(w,{duration:C,easing:z})),d=()=>{o(t(1,f=null))};return n.$$set=w=>{"value"in w&&r(t(0,m=w.value)),"enabled"in w&&t(2,c=w.enabled)},n.$$.update=()=>{n.$$.dirty&70&&f&&c&&re(m,s=i,s),n.$$.dirty&36&&c!==y&&(t(5,y=c),_(c))},[m,f,c,h,d,y,i]}class Ne extends Te{constructor(e){super(),ve(this,e,Dt,null,ye,{value:0,enabled:2,update:3,reset:4})}get update(){return this.$$.ctx[3]}get reset(){return this.$$.ctx[4]}}function Mt(n){let e,t,s,a,r,i,u={value:n[1],enabled:n[0]};e=new Ne({props:u}),n[11](e);let o={value:n[2],enabled:n[0]};s=new Ne({props:o}),n[12](s);let m={value:n[3],enabled:n[0]};return r=new Ne({props:m}),n[13](r),{c(){X(e.$$.fragment),t=ne(),X(s.$$.fragment),a=ne(),X(r.$$.fragment)},l(c){U(e.$$.fragment,c),t=se(c),U(s.$$.fragment,c),a=se(c),U(r.$$.fragment,c)},m(c,f){Z(e,c,f),M(c,t,f),Z(s,c,f),M(c,a,f),Z(r,c,f),i=!0},p(c,[f]){const T={};f&2&&(T.value=c[1]),f&1&&(T.enabled=c[0]),e.$set(T);const p={};f&4&&(p.value=c[2]),f&1&&(p.enabled=c[0]),s.$set(p);const y={};f&8&&(y.value=c[3]),f&1&&(y.enabled=c[0]),r.$set(y)},i(c){i||(q(e.$$.fragment,c),q(s.$$.fragment,c),q(r.$$.fragment,c),i=!0)},o(c){G(e.$$.fragment,c),G(s.$$.fragment,c),G(r.$$.fragment,c),i=!1},d(c){c&&(I(t),I(a)),n[11](null),J(e,c),n[12](null),J(s,c),n[13](null),J(r,c)}}}function zt(n,e,t){let{camera:s}=e,{enabled:a=!0}=e,{x:r,y:i,scale:u}=s,o,m,c;const f=async(d,w,C,z=Me)=>{await Promise.all([o.update(d,C,z),m.update(w,C,z)])},T=async(d,w,C=Me)=>c.update(d,w,C),p=()=>{o.reset(),m.reset(),c.reset()};function y(d){Ve[d?"unshift":"push"](()=>{o=d,t(4,o)})}function _(d){Ve[d?"unshift":"push"](()=>{m=d,t(5,m)})}function h(d){Ve[d?"unshift":"push"](()=>{c=d,t(6,c)})}return n.$$set=d=>{"camera"in d&&t(7,s=d.camera),"enabled"in d&&t(0,a=d.enabled)},n.$$.update=()=>{n.$$.dirty&128&&t(1,{x:r,y:i,scale:u}=s,r,(t(2,i),t(7,s)),(t(3,u),t(7,s)))},[a,r,i,u,o,m,c,s,f,T,p,y,_,h]}class Ot extends Te{constructor(e){super(),ve(this,e,zt,Mt,ye,{camera:7,enabled:0,pan:8,zoom:9,resetTweens:10})}get pan(){return this.$$.ctx[8]}get zoom(){return this.$$.ctx[9]}get resetTweens(){return this.$$.ctx[10]}}function Lt(n){let e,t,s,a,r={camera:n[2],enabled:!n[0]};return e=new Ot({props:r}),n[21](e),{c(){X(e.$$.fragment)},l(i){U(e.$$.fragment,i)},m(i,u){Z(e,i,u),t=!0,s||(a=ge(window,"keydown",n[9],!0),s=!0)},p(i,u){const o={};u[0]&4&&(o.camera=i[2]),u[0]&1&&(o.enabled=!i[0]),e.$set(o)},i(i){t||(q(e.$$.fragment,i),t=!0)},o(i){G(e.$$.fragment,i),t=!1},d(i){n[21](null),J(e,i),s=!1,a()}}}function Bt(n,e,t){let s,a,r,i=L,u=()=>(i(),i=F(A,b=>t(18,r=b)),A),o,m=L,c=()=>(m(),m=F(V,b=>t(25,o=b)),V),f,T=L,p=()=>(T(),T=F(Y,b=>t(26,f=b)),Y),y,_=L,h=()=>(_(),_=F(v,b=>t(27,y=b)),v),d,w=L,C=()=>(w(),w=F(R,b=>t(19,d=b)),R),z;n.$$.on_destroy.push(()=>i()),n.$$.on_destroy.push(()=>m()),n.$$.on_destroy.push(()=>T()),n.$$.on_destroy.push(()=>_()),n.$$.on_destroy.push(()=>w());let{camera:P}=e,{clock:R}=e;C();let{hooks:l}=e,{create_tour_data:k}=e,{paused:W=!d.running}=e,{tweenedCamera:E=void 0}=e;const A=de(!1);u();const Y=de(0);p();const V=de(0);c();const v=de(null);h();const j=()=>{ae(!1)},te=b=>{Ce(b)},oe=b=>{Ce(f+b)},me=b=>{if(!y)throw Error("expected tourData");Ce(y.steps[ce(y.steps,b)].startTime)};let le=!1;const ae=b=>{if(le)throw Error("Called finish twice");le=!0,H.done(b)};let ue=!1;const he=new Map,be=async b=>{if(!ue){if(!y)throw Error("expected tourData");re(Y,f+=b,f);for(let O=o;O<y.steps.length;O++){const x=y.steps[O];if(x.startTime>f)break;const $=x.duration-(f-x.startTime);switch(console.log("tour step and duration",$,x),x.type){case"pan":{H.pan(x.x,x.y,$,x.easing);break}case"zoom":{H.zoom(x.scale,$,x.easing);break}case"event":{const Le=H.event(x.name,x.data);Le&&he.set(x.name,Le);break}case"waitForEvent":{ue=!0,await he.get(x.name),he.delete(x.name),ue=!1;break}default:throw new Fe(x)}O===y.steps.length-1&&ae(!0),re(V,o=o===y.steps.length-1?-1:o+1,o)}}},Ce=b=>{if(!y)throw Error("expected tourData");re(Y,f=Math.min(Math.max(0,b),y.totalDuration),f),re(V,o=fe(y.steps,f),o);const O=Pe(y.steps,"pan",o-1);O&&H.pan(O.x,O.y,0,O.easing);const x=Pe(y.steps,"zoom",o-1);x&&H.zoom(x.scale,0,x.easing),be(0),f!==y.totalDuration&&H.seek(f,o)},ce=(b,O)=>Math.max(0,Math.min(Math.round(O),b.length-1)),fe=(b,O)=>{for(let x=0;x<b.length;x++){const $=b[x];if($.startTime+$.duration>=O&&($.type==="pan"||$.type==="zoom"))return x}return-1},H={pan:(b,O,x,$)=>(E.pan(b,O,x,$),l.pan?.(b,O,x,$)),zoom:(b,O,x)=>(E.zoom(b,O,x),l.zoom?.(b,O,x)),event:(b,O)=>(b.startsWith("debug")&&console.log(b,f),l.event?.(b,O)),seek:(b,O)=>l.seek?.(b,O),done:b=>(re(A,r=!1,r),E.resetTweens(),a&&console.log("render stats",Tt()),l.done?.(b))},Ie=yt();it(n,Ie,b=>t(20,z=b));const Ee=ut(),ze=b=>{r&&b.key==="Escape"&&!b.ctrlKey&&(kt(b),j())},Oe=()=>{r&&j(),d.running||R.resume(),re(v,y=k(),y),re(Y,f=0,f),re(V,o=0,o),le=!1,re(A,r=!0,r),Ee("begin"),a&&vt()};ct(()=>{r&&j()});function Q(b){Ve[b?"unshift":"push"](()=>{E=b,t(1,E)})}return n.$$set=b=>{"camera"in b&&t(2,P=b.camera),"clock"in b&&C(t(3,R=b.clock)),"hooks"in b&&t(10,l=b.hooks),"create_tour_data"in b&&t(11,k=b.create_tour_data),"paused"in b&&t(0,W=b.paused),"tweenedCamera"in b&&t(1,E=b.tweenedCamera)},n.$$.update=()=>{n.$$.dirty[0]&524288&&t(17,{running:s}=d,s),n.$$.dirty[0]&131073&&W===s&&t(0,W=!s),n.$$.dirty[0]&917504&&s&&r&&d.dt>0&&be(d.dt),n.$$.dirty[0]&1048576&&(a=z.dev_mode)},[W,E,P,R,A,Y,V,v,Ie,ze,l,k,j,te,oe,me,Oe,s,r,d,z,Q]}class En extends Te{constructor(e){super(),ve(this,e,Bt,Lt,ye,{camera:2,clock:3,hooks:10,create_tour_data:11,paused:0,tweenedCamera:1,touring:4,currentTime:5,currentStepIndex:6,tourData:7,cancel:12,seekTimeTo:13,seekTimeBy:14,seekIndexTo:15,begin_tour:16},null,[-1,-1])}get touring(){return this.$$.ctx[4]}get currentTime(){return this.$$.ctx[5]}get currentStepIndex(){return this.$$.ctx[6]}get tourData(){return this.$$.ctx[7]}get cancel(){return this.$$.ctx[12]}get seekTimeTo(){return this.$$.ctx[13]}get seekTimeBy(){return this.$$.ctx[14]}get seekIndexTo(){return this.$$.ctx[15]}get begin_tour(){return this.$$.ctx[16]}}function tt(n,e,t){const s=n.slice();return s[8]=e[t],s[10]=t,s}function nt(n){let e,t=`âˆ™
		`,s,a;function r(){return n[5](n[10])}function i(){return n[6](n[10])}return{c(){e=we("button"),e.textContent=t,this.h()},l(u){e=ke(u,"BUTTON",{"aria-label":!0,class:!0,"data-svelte-h":!0}),dt(e)!=="svelte-122yt7e"&&(e.textContent=t),this.h()},h(){ee(e,"aria-label","select month "+(n[10]+1)),ee(e,"class","svelte-1sl3nl6"),ie(e,"active",n[10]===n[0]),ie(e,"selected",n[10]===n[1])},m(u,o){M(u,e,o),s||(a=[ge(e,"click",r),ge(e,"mouseenter",i),ge(e,"mouseleave",n[7])],s=!0)},p(u,o){n=u,o&1&&ie(e,"active",n[10]===n[0]),o&2&&ie(e,"selected",n[10]===n[1])},d(u){u&&I(e),s=!1,ot(a)}}}function Vt(n){let e,t=He({length:12}),s=[];for(let a=0;a<t.length;a+=1)s[a]=nt(tt(n,t,a));return{c(){e=we("div");for(let a=0;a<s.length;a+=1)s[a].c();this.h()},l(a){e=ke(a,"DIV",{class:!0});var r=Se(e);for(let i=0;i<s.length;i+=1)s[i].l(r);r.forEach(I),this.h()},h(){ee(e,"class","month-hud svelte-1sl3nl6")},m(a,r){M(a,e,r);for(let i=0;i<s.length;i+=1)s[i]&&s[i].m(e,null)},p(a,[r]){if(r&15){t=He({length:12});let i;for(i=0;i<t.length;i+=1){const u=tt(a,t,i);s[i]?s[i].p(u,r):(s[i]=nt(u),s[i].c(),s[i].m(e,null))}for(;i<s.length;i+=1)s[i].d(1);s.length=t.length}},i:L,o:L,d(a){a&&I(e),ft(s,a)}}}function At(n,e,t){let{active_land_index:s}=e,{selected_land_index:a}=e,{select_land_index:r}=e,{hover_land_index:i}=e;const u=f=>{r(a===f?null:f)},o=f=>u(f),m=f=>i(f),c=()=>i(null);return n.$$set=f=>{"active_land_index"in f&&t(0,s=f.active_land_index),"selected_land_index"in f&&t(1,a=f.selected_land_index),"select_land_index"in f&&t(4,r=f.select_land_index),"hover_land_index"in f&&t(2,i=f.hover_land_index)},[s,a,i,u,r,o,m,c]}class Dn extends Te{constructor(e){super(),ve(this,e,At,Vt,ye,{active_land_index:0,selected_land_index:1,select_land_index:4,hover_land_index:2})}}function Ft(n){let e,t,s,a;return{c(){e=we("div"),t=we("div"),this.h()},l(r){e=ke(r,"DIV",{class:!0,"aria-hidden":!0});var i=Se(e);t=ke(i,"DIV",{class:!0,style:!0}),Se(t).forEach(I),i.forEach(I),this.h()},h(){ee(t,"class","water-level-fill svelte-ivhs4t"),qe(t,"height",100*n[0]/n[1]+"%"),ee(e,"class","water-level svelte-ivhs4t"),ee(e,"aria-hidden",""),ie(e,"selected",n[2]!==null)},m(r,i){M(r,e,i),xe(e,t),n[7](e),s||(a=[ge(e,"click",n[8]),ge(e,"mouseenter",n[9]),ge(e,"mousemove",n[10]),ge(e,"mouseleave",n[11])],s=!0)},p(r,[i]){i&3&&qe(t,"height",100*r[0]/r[1]+"%"),i&4&&ie(e,"selected",r[2]!==null)},i:L,o:L,d(r){r&&I(e),n[7](null),s=!1,ot(a)}}}function Ht(n,e,t){let{sea_level:s}=e,{sea_index_max:a}=e,{selected_sea_level:r}=e,{select_sea_level:i}=e,{hover_sea_level:u}=e,o;const m=_=>{const h=o.getBoundingClientRect();return(1-(_-h.top)/(h.bottom-h.top))*a};function c(_){Ve[_?"unshift":"push"](()=>{o=_,t(5,o)})}const f=_=>i(r===null?m(_.clientY):null),T=_=>u(m(_.clientY)),p=_=>u(m(_.clientY)),y=()=>u(null);return n.$$set=_=>{"sea_level"in _&&t(0,s=_.sea_level),"sea_index_max"in _&&t(1,a=_.sea_index_max),"selected_sea_level"in _&&t(2,r=_.selected_sea_level),"select_sea_level"in _&&t(3,i=_.select_sea_level),"hover_sea_level"in _&&t(4,u=_.hover_sea_level)},[s,a,r,i,u,o,m,c,f,T,p,y]}class Mn extends Te{constructor(e){super(),ve(this,e,Ht,Ft,ye,{sea_level:0,sea_index_max:1,selected_sea_level:2,select_sea_level:3,hover_sea_level:4})}}const Pt=(n,e,t=new Array(n))=>{const s=Math.floor(e),a=s===n-1?0:s+1,r=e-s;for(let i=0;i<n;i++){let u=0;i===s?u=1:i===a&&(u=r),t[i]=u}return t},Rt=(n,e,t)=>e+n*(t===1&&e===n-1?1:2),Wt=(n,e,t=new Array(n),s)=>{const a=n-1,r=Math.min(a,Math.max(0,Math.floor(e))),i=r===a?null:r+1,u=i===null?0:e%1;for(let o=0;o<n;o++)t[o]=s===void 0||o>s?o===r?1:o===i?u:0:o===s?1:o===r?1-u:o>r?1:0;return t};function Yt(n){let e,t;return e=new xt({props:{width:n[3],height:n[2],scale:n[4],zoom:n[0].zoom_camera,pan:n[0].move_camera,disabled:!n[1]}}),{c(){X(e.$$.fragment)},l(s){U(e.$$.fragment,s)},m(s,a){Z(e,s,a),t=!0},p(s,a){const r={};a[0]&8&&(r.width=s[3]),a[0]&4&&(r.height=s[2]),a[0]&16&&(r.scale=s[4]),a[0]&1&&(r.zoom=s[0].zoom_camera),a[0]&1&&(r.pan=s[0].move_camera),a[0]&2&&(r.disabled=!s[1]),e.$set(r)},i(s){t||(q(e.$$.fragment,s),t=!0)},o(s){G(e.$$.fragment,s),t=!1},d(s){J(e,s)}}}function Nt(n,e,t){let s,a,r,i,u,o,m,c,f=L,T=()=>(f(),f=F(i,g=>t(2,c=g)),i),p,y=L,_=()=>(y(),y=F(r,g=>t(3,p=g)),r),h,d=L,w=()=>(d(),d=F(u,g=>t(4,h=g)),u),C,z=L,P=()=>(z(),z=F(a,g=>t(28,C=g)),a),R,l=L,k=()=>(l(),l=F(s,g=>t(29,R=g)),s);n.$$.on_destroy.push(()=>f()),n.$$.on_destroy.push(()=>y()),n.$$.on_destroy.push(()=>d()),n.$$.on_destroy.push(()=>z()),n.$$.on_destroy.push(()=>l());let{camera:W}=e,{input_enabled:E=!0}=e,{landImages:A}=e,{seaImages:Y}=e,{shoreImage:V=void 0}=e,{shoreImageCount:v=void 0}=e,{seashoreFloorIndex:j=void 0}=e,{lightsImage:te=void 0}=e,{lightsOpacity:oe=0}=e,{nightfallOpacity:me=0}=e,{showLights:le=!1}=e,{activeLandValue:ae}=e,{activeSeaLevel:ue}=e,{imageWidth:he}=e,{imageHeight:be}=e;if(V&&v===void 0)throw Error("shoreImageCount is required to be paired with shoreImage");const{pixi:Ce}=gt({load:async()=>{const g=[];for(const S of A)g.push(pe.load(S));for(const S of Y)g.push(pe.load(S));V&&g.push(pe.load(V)),te&&g.push(pe.load(te)),await Promise.all(g)},loaded:async g=>{Ee=new Be,g.addChild(Ee),ze=new Be,Ee.addChild(ze),ze.sortableChildren=!0;for(const S of A){const D=Ae(pe.get(S));ze.addChild(D),ce.push(D)}x(ce,o,m,h),Ue(ae),Oe=new Be,Ee.addChild(Oe);for(const S of Y){const D=Ae(pe.get(S));Oe.addChild(D),fe.push(D)}if(V){t(24,H=Ae(pe.get(V))),Oe.addChild(H);const S=new bt(void 0,lt,Le(v));t(24,H.filters=[S],H)}if(x(fe,o,m,h),Xe(ue),te){t(25,Q=new Be),Ee.addChild(Q);const S=new je(pt.WHITE,p,c);S.tint=0,S.alpha=0,Q.addChild(S),Ie.push(S);const D=Ae(pe.get(te));D.alpha=0,Q.addChild(D),Ie.push(D),x(Ie,o,m,h)}},destroy:()=>{console.log("destroyed earth")}}),ce=[],fe=[];let H;const Ie=[];let Ee,ze,Oe,Q;const b=(g,S,D)=>{for(const B of g)O(B,S,D)},O=(g,S,D)=>{g.width=S,g.height=D},x=(g,S,D,B)=>{for(const De of g)$(De,S,D,B)},$=(g,S,D,B)=>{g.tileScale.set(B),g.tilePosition.set(S,D)},Le=(g,S)=>{const D={};for(let B=0;B<g;B++)D["alpha"+B]=S?S[g-1-B]:0;return D},lt=`
		// TODO array of values, this is hacky for lack of knowledge
		uniform float alpha1;
		uniform float alpha2;
		uniform float alpha3;
		uniform float alpha4;
		uniform float alpha5;
		uniform float alpha6;
		uniform float alpha7;
		uniform float alpha8;
		uniform float alpha9;
		uniform float alpha10;
		uniform float alpha11;
		uniform float alpha12;
		uniform float alpha13;

		varying vec2 vTextureCoord;
		uniform sampler2D uSampler;

		void main() {
			vec4 color = texture2D(uSampler, vTextureCoord);
			int r = int(floor(color.r / color.a * 255.0 + 0.5));
			if (r == 218) {
				color *= alpha1;
			} else if (r == 202) {
				color *= alpha2;
			} else if (r == 187) {
				color *= alpha3;
			} else if (r == 171) {
				color *= alpha4;
			} else if (r == 151) {
				color *= alpha5;
			} else if (r == 133) {
				color *= alpha6;
			} else if (r == 118) {
				color *= alpha7;
			} else if (r == 104) {
				color *= alpha8;
			} else if (r == 89) {
				color *= alpha9;
			} else if (r == 76) {
				color *= alpha10;
			} else if (r == 72) {
				color *= alpha11;
			} else if (r == 68) {
				color *= alpha12;
			} else if (r == 65) {
				color *= alpha13;
			} else {
				color *= 0.0;
			}
			gl_FragColor = color;
		}
	`,Ke=Y.length+(V?v:0),We=new Array(Ke),Xe=g=>{Wt(Ke,g,We,j);for(let S=0;S<fe.length;S++)t(23,fe[S].alpha=We[S+(v||0)],fe);if(H){const S=Le(v,We),{uniforms:D}=H.filters[0];for(const B in S)D[B]=S[B]}},Ye=new Array(A.length),Ue=g=>{Pt(A.length,g,Ye);const S=ce.length;for(let D=0;D<S;D++){const B=ce[D],De=Ye[D];B.alpha!==De&&(B.alpha=De);const Ze=Rt(S,D,Ye[D]);Ze!==B.zIndex&&(B.zIndex=Ze)}},Ae=g=>{const S=new Je(g),D=new Je(g);D.angle=180,D.y=be*2,D.x=he;const B=new Be;B.addChild(S),B.addChild(D);const De=wt.create({width:he,height:be*2});return Ce.app.renderer.render(B,{renderTexture:De}),new je(De,p,c)};return n.$$set=g=>{"camera"in g&&t(0,W=g.camera),"input_enabled"in g&&t(1,E=g.input_enabled),"landImages"in g&&t(10,A=g.landImages),"seaImages"in g&&t(11,Y=g.seaImages),"shoreImage"in g&&t(12,V=g.shoreImage),"shoreImageCount"in g&&t(13,v=g.shoreImageCount),"seashoreFloorIndex"in g&&t(14,j=g.seashoreFloorIndex),"lightsImage"in g&&t(15,te=g.lightsImage),"lightsOpacity"in g&&t(16,oe=g.lightsOpacity),"nightfallOpacity"in g&&t(17,me=g.nightfallOpacity),"showLights"in g&&t(18,le=g.showLights),"activeLandValue"in g&&t(19,ae=g.activeLandValue),"activeSeaLevel"in g&&t(20,ue=g.activeSeaLevel),"imageWidth"in g&&t(21,he=g.imageWidth),"imageHeight"in g&&t(22,be=g.imageHeight)},n.$$.update=()=>{if(n.$$.dirty[0]&1&&k(t(9,{x:s,y:a,width:r,height:i,scale:u}=W,s,P(t(8,a)),_(t(7,r)),T(t(6,i)),w(t(5,u)))),n.$$.dirty[0]&536870936&&t(27,o=-R*h+p/2),n.$$.dirty[0]&268435476&&t(26,m=-C*h+c/2),n.$$.dirty[0]&34013184&&Q){const g=le;t(25,Q.visible=g,Q),g&&(t(25,Q.children[0].alpha=me,Q),t(25,Q.children[1].alpha=oe,Q))}n.$$.dirty[0]&12&&b(ce,p,c),n.$$.dirty[0]&8388620&&b(fe,p,c),n.$$.dirty[0]&16777228&&H&&O(H,p,c),n.$$.dirty[0]&12&&b(Ie,p,c),n.$$.dirty[0]&201326608&&x(ce,o,m,h),n.$$.dirty[0]&209715216&&x(fe,o,m,h),n.$$.dirty[0]&218103824&&H&&$(H,o,m,h),n.$$.dirty[0]&201326608&&x(Ie,o,m,h),n.$$.dirty[0]&9437184&&fe.length&&Xe(ue),n.$$.dirty[0]&524288&&ce.length&&Ue(ae)},[W,E,c,p,h,u,i,r,a,s,A,Y,V,v,j,te,oe,me,le,ae,ue,he,be,fe,H,Q,m,o,C,R]}class zn extends Te{constructor(e){super(),ve(this,e,Nt,Yt,ye,{camera:0,input_enabled:1,landImages:10,seaImages:11,shoreImage:12,shoreImageCount:13,seashoreFloorIndex:14,lightsImage:15,lightsOpacity:16,nightfallOpacity:17,showLights:18,activeLandValue:19,activeSeaLevel:20,imageWidth:21,imageHeight:22},null,[-1,-1])}}function Kt(n){let e;return{c(){e=N("play")},l(t){e=K(t,"play")},m(t,s){M(t,e,s)},d(t){t&&I(e)}}}function Xt(n){let e;return{c(){e=N("pause")},l(t){e=K(t,"pause")},m(t,s){M(t,e,s)},d(t){t&&I(e)}}}function Ut(n){let e;function t(r,i){return r[2]?Xt:Kt}let s=t(n),a=s(n);return{c(){a.c(),e=Ge()},l(r){a.l(r),e=Ge()},m(r,i){a.m(r,i),M(r,e,i)},p(r,i){s!==(s=t(r))&&(a.d(1),a=s(r),a&&(a.c(),a.m(e.parentNode,e)))},d(r){r&&I(e),a.d(r)}}}function Zt(n){let e,t=Qe(n[5]/1e3,1).toFixed(1)+"",s;return{c(){e=N("time: "),s=N(t)},l(a){e=K(a,"time: "),s=K(a,t)},m(a,r){M(a,e,r),M(a,s,r)},p(a,r){r&32&&t!==(t=Qe(a[5]/1e3,1).toFixed(1)+"")&&Re(s,t)},d(a){a&&(I(e),I(s))}}}function qt(n){let e,t;return{c(){e=N("index: "),t=N(n[6])},l(s){e=K(s,"index: "),t=K(s,n[6])},m(s,a){M(s,e,a),M(s,t,a)},p(s,a){a&64&&Re(t,s[6])},d(s){s&&(I(e),I(t))}}}function Gt(n){let e,t=Math.round(n[1]/1e3)+"",s,a;return{c(){e=N("seek to "),s=N(t),a=N("s")},l(r){e=K(r,"seek to "),s=K(r,t),a=K(r,"s")},m(r,i){M(r,e,i),M(r,s,i),M(r,a,i)},p(r,i){i&2&&t!==(t=Math.round(r[1]/1e3)+"")&&Re(s,t)},d(r){r&&(I(e),I(s),I(a))}}}function Jt(n){let e;return{c(){e=N("seek +1s")},l(t){e=K(t,"seek +1s")},m(t,s){M(t,e,s)},d(t){t&&I(e)}}}function jt(n){let e;return{c(){e=N("seek -1s")},l(t){e=K(t,"seek -1s")},m(t,s){M(t,e,s)},d(t){t&&I(e)}}}function Qt(n){let e;return{c(){e=N("seek +10s")},l(t){e=K(t,"seek +10s")},m(t,s){M(t,e,s)},d(t){t&&I(e)}}}function $t(n){let e;return{c(){e=N("seek -10s")},l(t){e=K(t,"seek -10s")},m(t,s){M(t,e,s)},d(t){t&&I(e)}}}function en(n){let e;return{c(){e=N("seek +100s")},l(t){e=K(t,"seek +100s")},m(t,s){M(t,e,s)},d(t){t&&I(e)}}}function tn(n){let e;return{c(){e=N("seek -100s")},l(t){e=K(t,"seek -100s")},m(t,s){M(t,e,s)},d(t){t&&I(e)}}}function nn(n){let e,t,s,a,r,i,u,o,m,c,f,T,p,y,_,h,d,w,C,z,P,R;return e=new _e({props:{$$slots:{default:[Ut]},$$scope:{ctx:n}}}),e.$on("click",n[10]),s=new _e({props:{$$slots:{default:[Zt]},$$scope:{ctx:n}}}),r=new _e({props:{$$slots:{default:[qt]},$$scope:{ctx:n}}}),r.$on("click",n[11]),u=new _e({props:{$$slots:{default:[Gt]},$$scope:{ctx:n}}}),u.$on("click",n[12]),m=new _e({props:{$$slots:{default:[Jt]},$$scope:{ctx:n}}}),m.$on("click",n[13]),f=new _e({props:{$$slots:{default:[jt]},$$scope:{ctx:n}}}),f.$on("click",n[14]),p=new _e({props:{$$slots:{default:[Qt]},$$scope:{ctx:n}}}),p.$on("click",n[15]),_=new _e({props:{$$slots:{default:[$t]},$$scope:{ctx:n}}}),_.$on("click",n[16]),d=new _e({props:{$$slots:{default:[en]},$$scope:{ctx:n}}}),d.$on("click",n[17]),C=new _e({props:{$$slots:{default:[tn]},$$scope:{ctx:n}}}),C.$on("click",n[18]),{c(){X(e.$$.fragment),t=ne(),X(s.$$.fragment),a=ne(),X(r.$$.fragment),i=ne(),X(u.$$.fragment),o=ne(),X(m.$$.fragment),c=ne(),X(f.$$.fragment),T=ne(),X(p.$$.fragment),y=ne(),X(_.$$.fragment),h=ne(),X(d.$$.fragment),w=ne(),X(C.$$.fragment)},l(l){U(e.$$.fragment,l),t=se(l),U(s.$$.fragment,l),a=se(l),U(r.$$.fragment,l),i=se(l),U(u.$$.fragment,l),o=se(l),U(m.$$.fragment,l),c=se(l),U(f.$$.fragment,l),T=se(l),U(p.$$.fragment,l),y=se(l),U(_.$$.fragment,l),h=se(l),U(d.$$.fragment,l),w=se(l),U(C.$$.fragment,l)},m(l,k){Z(e,l,k),M(l,t,k),Z(s,l,k),M(l,a,k),Z(r,l,k),M(l,i,k),Z(u,l,k),M(l,o,k),Z(m,l,k),M(l,c,k),Z(f,l,k),M(l,T,k),Z(p,l,k),M(l,y,k),Z(_,l,k),M(l,h,k),Z(d,l,k),M(l,w,k),Z(C,l,k),z=!0,P||(R=ge(window,"keydown",n[8]),P=!0)},p(l,[k]){const W={};k&524292&&(W.$$scope={dirty:k,ctx:l}),e.$set(W);const E={};k&524320&&(E.$$scope={dirty:k,ctx:l}),s.$set(E);const A={};k&524352&&(A.$$scope={dirty:k,ctx:l}),r.$set(A);const Y={};k&524290&&(Y.$$scope={dirty:k,ctx:l}),u.$set(Y);const V={};k&524288&&(V.$$scope={dirty:k,ctx:l}),m.$set(V);const v={};k&524288&&(v.$$scope={dirty:k,ctx:l}),f.$set(v);const j={};k&524288&&(j.$$scope={dirty:k,ctx:l}),p.$set(j);const te={};k&524288&&(te.$$scope={dirty:k,ctx:l}),_.$set(te);const oe={};k&524288&&(oe.$$scope={dirty:k,ctx:l}),d.$set(oe);const me={};k&524288&&(me.$$scope={dirty:k,ctx:l}),C.$set(me)},i(l){z||(q(e.$$.fragment,l),q(s.$$.fragment,l),q(r.$$.fragment,l),q(u.$$.fragment,l),q(m.$$.fragment,l),q(f.$$.fragment,l),q(p.$$.fragment,l),q(_.$$.fragment,l),q(d.$$.fragment,l),q(C.$$.fragment,l),z=!0)},o(l){G(e.$$.fragment,l),G(s.$$.fragment,l),G(r.$$.fragment,l),G(u.$$.fragment,l),G(m.$$.fragment,l),G(f.$$.fragment,l),G(p.$$.fragment,l),G(_.$$.fragment,l),G(d.$$.fragment,l),G(C.$$.fragment,l),z=!1},d(l){l&&(I(t),I(a),I(i),I(o),I(c),I(T),I(y),I(h),I(w)),J(e,l),J(s,l),J(r,l),J(u,l),J(m,l),J(f,l),J(p,l),J(_,l),J(d,l),J(C,l),P=!1,R()}}}const st=1e3,rt=1e4,at=1e5;function sn(n,e,t){let s,a,r,i,u,o=L,m=()=>(o(),o=F(s,E=>t(5,u=E)),s),c,f=L,T=()=>(f(),f=F(a,E=>t(6,c=E)),a);n.$$.on_destroy.push(()=>o()),n.$$.on_destroy.push(()=>f());let{tour:p}=e,{debug_start_time:y}=e;const _=St();it(n,_,E=>t(9,i=E));const h=E=>{switch(E.key){case"ArrowLeft":{p.seekTimeBy(E.shiftKey?E.ctrlKey?-at:-rt:-st);break}case"ArrowRight":{p.seekTimeBy(E.shiftKey?E.ctrlKey?at:rt:st);break}}},d=()=>_.toggle(),w=()=>{const E=Number(prompt("index?",c+""));Number.isNaN(E)||p.seekIndexTo(E)},C=()=>{p.seekTimeTo(y)},z=()=>{p.seekTimeBy(1e3)},P=()=>{p.seekTimeBy(-1e3)},R=()=>{p.seekTimeBy(1e4)},l=()=>{p.seekTimeBy(-1e4)},k=()=>{p.seekTimeBy(1e5)},W=()=>{p.seekTimeBy(-1e5)};return n.$$set=E=>{"tour"in E&&t(0,p=E.tour),"debug_start_time"in E&&t(1,y=E.debug_start_time)},n.$$.update=()=>{n.$$.dirty&1&&m(t(4,{currentTime:s,currentStepIndex:a}=p,s,T(t(3,a)))),n.$$.dirty&512&&t(2,{running:r}=i,r)},[p,y,r,a,s,u,c,_,h,i,d,w,C,z,P,R,l,k,W]}class On extends Te{constructor(e){super(),ve(this,e,sn,nn,ye,{tour:0,debug_start_time:1})}}const rn=1.1;function an(n,e,t){let s,a=L,r=()=>(a(),a=F(k,v=>t(12,s=v)),k),i,u=L,o=()=>(u(),u=F(l,v=>t(13,i=v)),l),m,c=L,f=()=>(c(),c=F(E,v=>t(14,m=v)),E),T,p=L,y=()=>(p(),p=F(W,v=>t(15,T=v)),W),_,h=L,d=()=>(h(),h=F(A,v=>t(16,_=v)),A);n.$$.on_destroy.push(()=>a()),n.$$.on_destroy.push(()=>u()),n.$$.on_destroy.push(()=>c()),n.$$.on_destroy.push(()=>p()),n.$$.on_destroy.push(()=>h());let{initialX:w=0}=e,{initialY:C=0}=e,{initialWidth:z=0}=e,{initialHeight:P=0}=e,{initialScale:R=1}=e;const l=de(w);o();const k=de(C);r();const W=de(z);y();const E=de(P);f();const A=de(R);d();const Y=(v,j=T/2,te=m/2,oe=rn)=>{if(v===0)return;const me=v>0?1/oe:oe,le=_,ae=le*me;re(A,_=ae,_);const ue=(ae-le)/le,he=j-T/2,be=te-m/2,Ce=he*ue/ae,ce=be*ue/ae;V(Ce,ce)},V=(v,j)=>{re(l,i+=v,i),re(k,s+=j,s)};return n.$$set=v=>{"initialX"in v&&t(5,w=v.initialX),"initialY"in v&&t(6,C=v.initialY),"initialWidth"in v&&t(7,z=v.initialWidth),"initialHeight"in v&&t(8,P=v.initialHeight),"initialScale"in v&&t(9,R=v.initialScale)},[l,k,W,E,A,w,C,z,P,R,Y,V]}class Ln extends Te{constructor(e){super(),ve(this,e,an,null,ye,{initialX:5,initialY:6,initialWidth:7,initialHeight:8,initialScale:9,x:0,y:1,width:2,height:3,scale:4,zoom_camera:10,move_camera:11})}get x(){return this.$$.ctx[0]}get y(){return this.$$.ctx[1]}get width(){return this.$$.ctx[2]}get height(){return this.$$.ctx[3]}get scale(){return this.$$.ctx[4]}get zoom_camera(){return this.$$.ctx[10]}get move_camera(){return this.$$.ctx[11]}}export{Ln as C,zn as E,Dn as M,vn as R,Mn as S,On as T,En as a,In as b,Cn as c,Pt as d,Rt as e,xn as f,Wt as g,Sn as u};
