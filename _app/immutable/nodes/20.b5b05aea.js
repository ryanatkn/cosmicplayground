var Et=Object.defineProperty;var Tt=(l,e,t)=>e in l?Et(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var x=(l,e,t)=>(Tt(l,typeof e!="symbol"?e+"":e,t),t);import{n as Se,e as N,s as K,b as R,l as q,d as S,c as V,m as f,p as $e,i as A,L as Fe,a as ye,E as Ct,v as Dt,r as ue,o as T,J as Y,C as Qe,a6 as It,a4 as Ot,T as gt,x as ae,y as ce,g as ie,N as le,Q as re,U as bt,V as kt,W as wt,G as Nt,K as Rt,I as et,F as Ht,A as Ut}from"../chunks/scheduler.317e39f5.js";import{S as Ne,i as Re,c as fe,a as de,m as me,t as M,b as X,d as he,g as we,e as ve,f as Wt}from"../chunks/index.3972ef43.js";import{g as Ze}from"../chunks/clock.fa46b71f.js";import{D as vt,a as Pt,S as zt,d as At,E as pe,u as Lt,c as Mt,f as Ge}from"../chunks/stage.95abb895.js";import{s as De}from"../chunks/dom.affe8f60.js";import{g as Yt}from"../chunks/dimensions.37c4a151.js";import{e as Ie}from"../chunks/dom.194afe55.js";import{W as Ft,S as Xt,D as Kt}from"../chunks/DomCanvasRenderer.e94d6f27.js";import{b as St}from"../chunks/pixi.d26d8403.js";import{g as Vt}from"../chunks/idle.b07fc2c8.js";import{a as Z}from"../chunks/random.c2e51b4a.js";import{w as Bt}from"../chunks/index.28c54d51.js";import{e as tt,u as Gt,o as qt}from"../chunks/each.5e813342.js";import{l as qe,s as Je}from"../chunks/storage.18a7f2b0.js";import{A as Jt}from"../chunks/AppDialog.fa5e3fad.js";import{A as jt}from"../chunks/AppControlsTable.eb26838a.js";const yt={freezeCamera:!1,playerSpeed:.6,playerStrength:vt,timeDilation:Pt};function Qt(l){let e,t,s,n,i;return t=new Ft({props:{worldWidth:l[5],worldHeight:l[6],viewWidth:l[3],viewHeight:l[4],viewportWidth:l[1],viewportHeight:l[2],stage:l[0],pixi:l[12],domCanvasRenderer:l[10]}}),n=new Xt({props:{controller:l[7]}}),{c(){e=N("div"),fe(t.$$.fragment),s=K(),fe(n.$$.fragment),this.h()},l(o){e=R(o,"DIV",{class:!0});var r=q(e);de(t.$$.fragment,r),r.forEach(S),s=V(o),de(n.$$.fragment,o),this.h()},h(){f(e,"class","view svelte-1fxwwt5"),$e(e,"transform",l[9])},m(o,r){A(o,e,r),me(t,e,null),A(o,s,r),me(n,o,r),i=!0},p(o,[r]){const a={};r&32&&(a.worldWidth=o[5]),r&64&&(a.worldHeight=o[6]),r&8&&(a.viewWidth=o[3]),r&16&&(a.viewHeight=o[4]),r&2&&(a.viewportWidth=o[1]),r&4&&(a.viewportHeight=o[2]),r&1&&(a.stage=o[0]),r&1024&&(a.domCanvasRenderer=o[10]),t.$set(a),r&512&&$e(e,"transform",o[9]);const u={};r&128&&(u.controller=o[7]),n.$set(u)},i(o){i||(M(t.$$.fragment,o),M(n.$$.fragment,o),i=!0)},o(o){X(t.$$.fragment,o),X(n.$$.fragment,o),i=!1},d(o){o&&(S(e),S(s)),he(t),he(n,o)}}}const Zt=3e4;function xt(l,e,t){let s,n,i,o=ye,r=()=>(o(),o=Ct(U,d=>t(21,i=d)),U),a,u;l.$$.on_destroy.push(()=>o());let{viewportWidth:p}=e,{viewportHeight:g}=e,{viewWidth:y}=e,{viewHeight:_}=e,{worldWidth:E}=e,{worldHeight:h}=e,{cameraUnlocked:H=!1}=e,{finish:C}=e,{stage:v}=e,{enableDomCanvasRenderer:w=!1}=e;const c=Ze();Fe(l,c,d=>t(18,a=d));const b=St(),W=Vt();Fe(l,W,d=>t(19,u=d));let k,U,I,B=!1;const P=()=>{!B&&v.time>Zt&&(B=!0,C(i))},D=(d,J,L,F)=>{if(d===L&&J===F)return"";const Q=Math.min(d/L,J/F);return`scale3d(${Q}, ${Q}, 1)`};return l.$$set=d=>{"viewportWidth"in d&&t(1,p=d.viewportWidth),"viewportHeight"in d&&t(2,g=d.viewportHeight),"viewWidth"in d&&t(3,y=d.viewWidth),"viewHeight"in d&&t(4,_=d.viewHeight),"worldWidth"in d&&t(5,E=d.worldWidth),"worldHeight"in d&&t(6,h=d.worldHeight),"cameraUnlocked"in d&&t(14,H=d.cameraUnlocked),"finish"in d&&t(15,C=d.finish),"stage"in d&&t(0,v=d.stage),"enableDomCanvasRenderer"in d&&t(16,w=d.enableDomCanvasRenderer)},l.$$.update=()=>{l.$$.dirty&16384&&t(0,v.freezeCamera=!H,v),l.$$.dirty&1&&console.log("UnlockStage.svelte stage",v),l.$$.dirty&65536&&t(10,s=w?new Kt:null),l.$$.dirty&524288&&u&&c.pause(),l.$$.dirty&1&&t(17,{camera:k,scores:U,controller:I}=v,k,r(t(8,U)),(t(7,I),t(0,v),t(1,p),t(2,g),t(3,y),t(4,_),t(5,E),t(6,h),t(14,H))),l.$$.dirty&262145&&P(),l.$$.dirty&147457&&H&&k.setPosition(v.player.x,v.player.y),l.$$.dirty&130&&I&&t(7,I.viewportWidth=p,I),l.$$.dirty&132&&I&&t(7,I.viewportHeight=g,I),l.$$.dirty&136&&I&&t(7,I.viewWidth=y,I),l.$$.dirty&144&&I&&t(7,I.viewHeight=_,I),l.$$.dirty&160&&I&&t(7,I.worldWidth=E,I),l.$$.dirty&192&&I&&t(7,I.worldHeight=h,I),l.$$.dirty&120&&t(9,n=D(y,_,E,h))},[v,p,g,y,_,E,h,I,U,n,s,c,b,W,H,C,w,k,a,u]}class $t extends Ne{constructor(e){super(),Re(this,e,xt,Qt,Se,{viewportWidth:1,viewportHeight:2,viewWidth:3,viewHeight:4,worldWidth:5,worldHeight:6,cameraUnlocked:14,finish:15,stage:0,enableDomCanvasRenderer:16})}}const el=[.833,.76,.72],tl=[.611,1,.7],Me=[.389,.8,.6],ll=[.12,.16,.5],lt=[0,1,.5],sl="ðŸ¢",Oe=["ðŸ’§","ðŸŒ±","ðŸŒ³","ðŸŒ¿","ðŸŒ²"],nl="ðŸª¨",ol=.6,il=vt*.96,rl=100,Ye=.03,al=.21,cl=100,ke=l=>l*1.4,st=l=>({bonus:l.bonus});class ul extends zt{constructor(t){super(t);x(this,"finished",!1);x(this,"bonus",0);x(this,"player");x(this,"planet");x(this,"rock");x(this,"moons",new Set);x(this,"moonsArray",[]);x(this,"moonFragments",new Set);x(this,"planetFragments",new Set);x(this,"rockFragments",new Set);x(this,"lastPlayerX",0);x(this,"lastPlayerY",0);x(this,"scores");const{data:s}=t,n=850,i=502;this.freezeCamera||this.camera.setPosition(n,i);const{sim:o,collisions:r,controller:a,moons:u}=this;console.log("setup stage, sim, controller",o,a);const p=this.player=new pe(r.create_circle(n,i,rl));p.text=sl,p.fontSize=ke(p.radius),p.speed=(s==null?void 0:s.playerSpeed)??ol,p.strength=(s==null?void 0:s.playerStrength)??il,p.color=el,this.addEntity(p);const g=1618,y=this.planet=new pe(r.create_circle(-1450+g/2,-1750+g/2,g));y.text=Oe[0],y.textOffsetX=850,y.textOffsetY=1150,y.fontSize=200,y.color=tl,this.addEntity(y);const _=262,E=this.rock=new pe(r.create_circle(2275+_/2,1200+_/2,_));E.speed=al,E.directionX=-1,E.directionY=-.7,E.text=nl,E.fontSize=ke(E.radius),E.color=ll,this.addEntity(E);let h=new pe(r.create_circle(1660,1012,43));h.text=Oe[1],h.fontSize=ke(h.radius),h.speed=Ye,h.color=Me,this.addEntity(h),u.add(h),h=new pe(r.create_circle(1420,1174,72)),h.text=Oe[2],h.fontSize=ke(h.radius),h.speed=Ye,h.color=Me,this.addEntity(h),u.add(h),h=new pe(r.create_circle(2010,872,19)),h.text=Oe[3],h.fontSize=ke(h.radius),h.speed=Ye,h.color=Me,this.addEntity(h),u.add(h),h=new pe(r.create_circle(1870,776,27)),h.text=Oe[4],h.fontSize=ke(h.radius),h.speed=Ye,h.color=Me,this.addEntity(h),u.add(h),this.moonsArray.push(...u),this.scores=Bt(st(this))}updateScores(){const t=st(this);At(t,Dt(this.scores))||this.scores.set(t)}update(t){const s=this.timeDilation*Math.min(Math.max(t,0),cl);super.update(s);const{collisions:n,controller:i,player:o,planet:r,rock:a,moons:u,planetFragments:p,moonFragments:g,rockFragments:y,$camera:_}=this;Lt(i,o,_);let E=null,h=null,H=null,C=!1;this.sim.update(s,(c,b,W)=>{Mt(c,b,W);const k=a===c?c:a===b?b:null,U=r===c?c:r===b?b:null,I=u.has(c)?c:u.has(b)?b:null,B=y.has(c)?c:y.has(b)?b:null,P=p.has(c)?c:p.has(b)?b:null,D=g.has(c)?c:g.has(b)?b:null,d=k||B||P||D;if(I&&d){const J=d===k,L=d===D,F=Ge(I,n,12);C=!0,(H||(H=[])).push(...F),this.removeEntity(I);for(const Q of F)Q.speed=J?Z(d.speed*1.2,d.speed*2.44):L?Z(d.speed/2,d.speed*2):Z(d.speed/8,d.speed),Q.directionX=J?Z(d.directionX/2,d.directionX*2):L?Z(d.directionX/2,d.directionX*2):Z(-d.directionX/2,d.directionX),Q.directionY=J?Z(d.directionY/2,d.directionY*2):L?Z(d.directionY/2,d.directionY*2):Z(-d.directionY/2,d.directionY),Q.color=lt}else if(k&&U){this.removeEntity(k),this.removeEntity(U);const J=Ge(U,n,42);C=!0,(h||(h=[])).push(...J);for(const F of J)F.speed=k.speed*.2*Z(.5,1),F.directionX=Z(-k.directionX/2,k.directionX/2),F.directionY=Z(-k.directionY/2,k.directionY/2),F.color=lt;const L=Ge(k,n,210);(E||(E=[])).push(...L);for(const F of L)F.speed=Z(k.speed/2,k.speed*2),F.directionX=Z(-k.directionX*2,k.directionX*.25),F.directionY=Z(-k.directionY*2,k.directionY*.25)}else D&&(U||P||B)&&this.removeEntity(D)},(c,b)=>{const W=c.entity,k=b.entity;if(W.dead||k.dead||W.disableSimulation||k.disableSimulation)return!1;const U=o===W?W:o===k?k:null,I=r===W?W:r===k?k:null,B=u.has(W)?W:u.has(k)?k:null;return!(U&&(I||B))});const{x:v,y:w}=o;if(this.freezeCamera){const c=o.radius+1,b=_.left+c,W=_.right-c;v<b?o.x=b:v>W&&(o.x=W);const k=_.top+c,U=_.bottom-c;w<k?o.y=k:w>U&&(o.y=U)}else(v!==this.lastPlayerX||w!==this.lastPlayerY)&&(this.camera.setPosition(v,w),this.lastPlayerX=v,this.lastPlayerY=w);if(E)for(const c of E)y.add(c),this.addEntity(c);if(h)for(const c of h)p.add(c),this.addEntity(c);if(H)for(const c of H)g.add(c),this.addEntity(c);C&&this.updateScores()}}function nt(l){let e,t,s=l[8]&&ot(l);return{c(){e=N("div"),s&&s.c(),this.h()},l(n){e=R(n,"DIV",{class:!0});var i=q(e);s&&s.l(i),i.forEach(S),this.h()},h(){f(e,"class","stage-data-controls-wrapper svelte-18u3mmz")},m(n,i){A(n,e,i),s&&s.m(e,null),t=!0},p(n,i){n[8]?s?(s.p(n,i),i[0]&256&&M(s,1)):(s=ot(n),s.c(),M(s,1),s.m(e,null)):s&&(we(),X(s,1,1,()=>{s=null}),ve())},i(n){t||(M(s),t=!0)},o(n){X(s),t=!1},d(n){n&&S(e),s&&s.d()}}}function ot(l){let e,t,s,n,i,o,r,a,u,p,g,y,_,E,h,H,C,v,w,c,b,W,k,U,I,B,P,D,d="â®",J,L,F,Q,ge,$,se="â†’",Ee,ee,He="â† ",Te,te,Ue="â‡¶",be,ne,Ce,We;function Pe(O,z){return O[12]?dl:fl}let m=Pe(l),G=m(l);const _e=l[26].default,j=gt(_e,l,l[25],null);return{c(){e=N("div"),t=N("label"),s=N("input"),n=ae(" free camera"),i=K(),o=N("div"),r=N("input"),a=K(),u=N("label"),p=N("input"),g=ae(" player strength"),y=K(),_=N("div"),E=N("input"),h=K(),H=N("label"),C=N("input"),v=ae(" player speed"),w=K(),c=N("div"),b=N("input"),W=K(),k=N("label"),U=N("input"),I=ae(" time dilation"),B=K(),P=N("div"),D=N("button"),D.textContent=d,J=K(),L=N("button"),G.c(),ge=K(),$=N("button"),$.textContent=se,Ee=K(),ee=N("button"),ee.textContent=He,Te=K(),te=N("button"),te.textContent=Ue,be=K(),j&&j.c(),this.h()},l(O){e=R(O,"DIV",{class:!0});var z=q(e);t=R(z,"LABEL",{});var Xe=q(t);s=R(Xe,"INPUT",{type:!0}),n=ce(Xe," free camera"),Xe.forEach(S),i=V(z),o=R(z,"DIV",{class:!0});var ze=q(o);r=R(ze,"INPUT",{type:!0,min:!0,max:!0,step:!0}),a=V(ze),u=R(ze,"LABEL",{});var Ke=q(u);p=R(Ke,"INPUT",{type:!0,step:!0,class:!0}),g=ce(Ke," player strength"),Ke.forEach(S),ze.forEach(S),y=V(z),_=R(z,"DIV",{class:!0});var Ae=q(_);E=R(Ae,"INPUT",{type:!0,min:!0,max:!0,step:!0}),h=V(Ae),H=R(Ae,"LABEL",{});var Ve=q(H);C=R(Ve,"INPUT",{type:!0,step:!0,class:!0}),v=ce(Ve," player speed"),Ve.forEach(S),Ae.forEach(S),w=V(z),c=R(z,"DIV",{class:!0});var Le=q(c);b=R(Le,"INPUT",{type:!0,min:!0,max:!0,step:!0}),W=V(Le),k=R(Le,"LABEL",{});var Be=q(k);U=R(Be,"INPUT",{type:!0,step:!0,class:!0}),I=ce(Be," time dilation"),Be.forEach(S),Le.forEach(S),B=V(z),P=R(z,"DIV",{class:!0});var oe=q(P);D=R(oe,"BUTTON",{title:!0,"aria-label":!0,class:!0,"data-svelte-h":!0}),ie(D)!=="svelte-mo0409"&&(D.textContent=d),J=V(oe),L=R(oe,"BUTTON",{title:!0,"aria-label":!0,class:!0});var xe=q(L);G.l(xe),xe.forEach(S),ge=V(oe),$=R(oe,"BUTTON",{title:!0,"aria-label":!0,class:!0,"data-svelte-h":!0}),ie($)!=="svelte-1slrg40"&&($.textContent=se),Ee=V(oe),ee=R(oe,"BUTTON",{title:!0,"aria-label":!0,class:!0,"data-svelte-h":!0}),ie(ee)!=="svelte-1r87iqa"&&(ee.textContent=He),Te=V(oe),te=R(oe,"BUTTON",{title:!0,"aria-label":!0,class:!0,"data-svelte-h":!0}),ie(te)!=="svelte-17eaxdx"&&(te.textContent=Ue),oe.forEach(S),z.forEach(S),be=V(O),j&&j.l(O),this.h()},h(){f(s,"type","checkbox"),f(r,"type","range"),f(r,"min",0),f(r,"max",10),f(r,"step",.1),f(p,"type","number"),f(p,"step",.1),f(p,"class","svelte-18u3mmz"),f(o,"class","control svelte-18u3mmz"),f(E,"type","range"),f(E,"min",0),f(E,"max",10),f(E,"step",.1),f(C,"type","number"),f(C,"step",.1),f(C,"class","svelte-18u3mmz"),f(_,"class","control svelte-18u3mmz"),f(b,"type","range"),f(b,"min",0),f(b,"max",10),f(b,"step",.1),f(U,"type","number"),f(U,"step",.1),f(U,"class","svelte-18u3mmz"),f(c,"class","control svelte-18u3mmz"),f(D,"title","[Spacebar] Reset the simulation"),f(D,"aria-label","Reset the simulation"),f(D,"class","svelte-18u3mmz"),f(L,"title",F="[Backtick] "+(l[12]?"Pause the simulation":"Play the simulation")),f(L,"aria-label",Q=l[12]?"Pause the simulation":"Play the simulation"),f(L,"class","svelte-18u3mmz"),f($,"title","[]] Simulate 1 tick"),f($,"aria-label","Simulate 1 tick"),f($,"class","svelte-18u3mmz"),f(ee,"title","[ctrl+]] Simulate 10 ticks"),f(ee,"aria-label","Simulate 10 ticks"),f(ee,"class","svelte-18u3mmz"),f(te,"title","[shift+]] Simulate 100 ticks"),f(te,"aria-label","Simulate 100 ticks"),f(te,"class","svelte-18u3mmz"),f(P,"class","buttons svelte-18u3mmz"),f(e,"class","stage-data-controls svelte-18u3mmz")},m(O,z){A(O,e,z),T(e,t),T(t,s),s.checked=l[0],T(t,n),T(e,i),T(e,o),T(o,r),le(r,l[2]),T(o,a),T(o,u),T(u,p),le(p,l[2]),T(u,g),T(e,y),T(e,_),T(_,E),le(E,l[1]),T(_,h),T(_,H),T(H,C),le(C,l[1]),T(H,v),T(e,w),T(e,c),T(c,b),le(b,l[3]),T(c,W),T(c,k),T(k,U),le(U,l[3]),T(k,I),T(e,B),T(e,P),T(P,D),T(P,J),T(P,L),G.m(L,null),T(P,ge),T(P,$),T(P,Ee),T(P,ee),T(P,Te),T(P,te),A(O,be,z),j&&j.m(O,z),ne=!0,Ce||(We=[Y(s,"change",l[27]),Y(r,"change",l[28]),Y(r,"input",l[28]),Y(p,"input",l[29]),Y(E,"change",l[30]),Y(E,"input",l[30]),Y(C,"input",l[31]),Y(b,"change",l[32]),Y(b,"input",l[32]),Y(U,"input",l[33]),Y(D,"click",l[17]),Y(L,"click",l[34]),Y($,"click",l[35]),Y(ee,"click",l[36]),Y(te,"click",l[37])],Ce=!0)},p(O,z){z[0]&1&&(s.checked=O[0]),z[0]&4&&le(r,O[2]),z[0]&4&&re(p.value)!==O[2]&&le(p,O[2]),z[0]&2&&le(E,O[1]),z[0]&2&&re(C.value)!==O[1]&&le(C,O[1]),z[0]&8&&le(b,O[3]),z[0]&8&&re(U.value)!==O[3]&&le(U,O[3]),m!==(m=Pe(O))&&(G.d(1),G=m(O),G&&(G.c(),G.m(L,null))),(!ne||z[0]&4096&&F!==(F="[Backtick] "+(O[12]?"Pause the simulation":"Play the simulation")))&&f(L,"title",F),(!ne||z[0]&4096&&Q!==(Q=O[12]?"Pause the simulation":"Play the simulation"))&&f(L,"aria-label",Q),j&&j.p&&(!ne||z[0]&33554432)&&bt(j,_e,O,O[25],ne?wt(_e,O[25],z,null):kt(O[25]),null)},i(O){ne||(M(j,O),ne=!0)},o(O){X(j,O),ne=!1},d(O){O&&(S(e),S(be)),G.d(),j&&j.d(O),Ce=!1,Qe(We)}}}function fl(l){let e;return{c(){e=ae("â–¶ï¸")},l(t){e=ce(t,"â–¶ï¸")},m(t,s){A(t,e,s)},d(t){t&&S(e)}}}function dl(l){let e;return{c(){e=ae("â¸")},l(t){e=ce(t,"â¸")},m(t,s){A(t,e,s)},d(t){t&&S(e)}}}function ml(l){let e;return{c(){e=ae("+")},l(t){e=ce(t,"+")},m(t,s){A(t,e,s)},d(t){t&&S(e)}}}function hl(l){let e;return{c(){e=ae("-")},l(t){e=ce(t,"-")},m(t,s){A(t,e,s)},d(t){t&&S(e)}}}function it(l){let e,t="import",s,n,i="save",o,r;return{c(){e=N("button"),e.textContent=t,s=K(),n=N("button"),n.textContent=i,this.h()},l(a){e=R(a,"BUTTON",{title:!0,"data-svelte-h":!0}),ie(e)!=="svelte-1t14zww"&&(e.textContent=t),s=V(a),n=R(a,"BUTTON",{title:!0,"data-svelte-h":!0}),ie(n)!=="svelte-1f9cabs"&&(n.textContent=i),this.h()},h(){f(e,"title","Import JSON data"),f(n,"title","[ctrl+s] Save to localStorage")},m(a,u){A(a,e,u),A(a,s,u),A(a,n,u),o||(r=[Y(e,"click",l[16]),Y(n,"click",l[15])],o=!0)},p:ye,d(a){a&&(S(e),S(s),S(n)),o=!1,Qe(r)}}}function rt(l){let e=l[8],t,s,n=at(l);return{c(){n.c(),t=ue()},l(i){n.l(i),t=ue()},m(i,o){n.m(i,o),A(i,t,o),s=!0},p(i,o){o[0]&256&&Se(e,e=i[8])?(we(),X(n,1,1,ye),ve(),n=at(i),n.c(),M(n,1),n.m(t.parentNode,t)):n.p(i,o)},i(i){s||(M(n),s=!0)},o(i){X(n),s=!1},d(i){i&&S(t),n.d(i)}}}function at(l){let e,t;return e=new $t({props:{viewportWidth:l[9],viewportHeight:l[10],viewWidth:l[4],viewHeight:l[5],worldWidth:l[6],worldHeight:l[7],cameraUnlocked:l[0],stage:l[8],finish:l[18],enableDomCanvasRenderer:pl}}),{c(){fe(e.$$.fragment)},l(s){de(e.$$.fragment,s)},m(s,n){me(e,s,n),t=!0},p(s,n){const i={};n[0]&512&&(i.viewportWidth=s[9]),n[0]&1024&&(i.viewportHeight=s[10]),n[0]&16&&(i.viewWidth=s[4]),n[0]&32&&(i.viewHeight=s[5]),n[0]&64&&(i.worldWidth=s[6]),n[0]&128&&(i.worldHeight=s[7]),n[0]&1&&(i.cameraUnlocked=s[0]),n[0]&256&&(i.stage=s[8]),e.$set(i)},i(s){t||(M(e.$$.fragment,s),t=!0)},o(s){X(e.$$.fragment,s),t=!1},d(s){he(e,s)}}}function _l(l){let e,t,s,n,i,o,r,a,u,p,g,y,_=l[11]&&nt(l);function E(w,c){return w[11]?hl:ml}let h=E(l),H=h(l),C=l[11]&&it(l),v=l[8]&&rt(l);return{c(){e=N("div"),_&&_.c(),t=K(),s=N("div"),n=N("button"),H.c(),r=K(),C&&C.c(),a=K(),v&&v.c(),u=ue(),this.h()},l(w){e=R(w,"DIV",{class:!0});var c=q(e);_&&_.l(c),t=V(c),s=R(c,"DIV",{class:!0});var b=q(s);n=R(b,"BUTTON",{"aria-label":!0,title:!0});var W=q(n);H.l(W),W.forEach(S),r=V(b),C&&C.l(b),b.forEach(S),c.forEach(S),a=V(w),v&&v.l(w),u=ue(),this.h()},h(){f(n,"aria-label",i=l[11]?"Hide controls":"Show controls"),f(n,"title",o="[Escape] "+(l[11]?"Hide controls":"Show controls")),f(s,"class","main-controls svelte-18u3mmz"),f(e,"class","controls svelte-18u3mmz")},m(w,c){A(w,e,c),_&&_.m(e,null),T(e,t),T(e,s),T(s,n),H.m(n,null),T(s,r),C&&C.m(s,null),A(w,a,c),v&&v.m(w,c),A(w,u,c),p=!0,g||(y=[Y(window,"keydown",l[20]),Y(n,"click",l[19])],g=!0)},p(w,c){w[11]?_?(_.p(w,c),c[0]&2048&&M(_,1)):(_=nt(w),_.c(),M(_,1),_.m(e,t)):_&&(we(),X(_,1,1,()=>{_=null}),ve()),h!==(h=E(w))&&(H.d(1),H=h(w),H&&(H.c(),H.m(n,null))),(!p||c[0]&2048&&i!==(i=w[11]?"Hide controls":"Show controls"))&&f(n,"aria-label",i),(!p||c[0]&2048&&o!==(o="[Escape] "+(w[11]?"Hide controls":"Show controls")))&&f(n,"title",o),w[11]?C?C.p(w,c):(C=it(w),C.c(),C.m(s,null)):C&&(C.d(1),C=null),w[8]?v?(v.p(w,c),c[0]&256&&M(v,1)):(v=rt(w),v.c(),M(v,1),v.m(u.parentNode,u)):v&&(we(),X(v,1,1,()=>{v=null}),ve())},i(w){p||(M(_),M(v),p=!0)},o(w){X(_),X(v),p=!1},d(w){w&&(S(e),S(a),S(u)),_&&_.d(),H.d(),C&&C.d(),v&&v.d(w),g=!1,Qe(y)}}}const pl=!1;function gl(l,e,t){let s,n,i,o,r,{$$slots:a={},$$scope:u}=e,{data:p}=e;const g=Yt();Fe(l,g,m=>t(24,r=m));const y=Ze();Fe(l,y,m=>t(23,o=m));const _=St(),E={width:2560,height:1440},h=It();let H=p;Ot(()=>{J()});const C=()=>{D&&(H=D.toData(),h("save",H))},v=()=>{let m=prompt("imported data",JSON.stringify(p));if(m!==null)if(m=m.trim(),m)try{t(22,p=JSON.parse(m))}catch{alert("failed to parse");return}else t(22,p=yt)},w=m=>{console.log("updateFromData",m),H=m,t(0,c=!m.freezeCamera),t(1,b=m.playerSpeed),t(2,W=m.playerStrength),t(3,k=m.timeDilation),J()};let c=!p.freezeCamera,b=p.playerSpeed,W=p.playerStrength,k=p.timeDilation,U,I,B,P,D=null;const d=()=>{D&&(D.destroy(),t(8,D=null))},J=()=>{D&&d(),t(8,D=new ul({exit:m=>console.log("exited stage",m),viewHeight:I,viewWidth:U,viewportHeight:n,viewportWidth:s,worldHeight:P,worldWidth:B,data:H||p}))},L=()=>{J()},F=async()=>{console.log("FINISH"),y.pause()};let Q=!0;const ge=()=>t(11,Q=!Q),$=m=>{m.key==="`"&&m.ctrlKey&&Ie(m.target)?(De(m),ge()):m.key===" "&&!m.ctrlKey&&Ie(m.target)?(De(m),L()):m.key==="s"&&m.ctrlKey&&Ie(m.target)?(De(m),C()):m.key==="}"&&Ie(m.target)?(De(m),se(100)):m.key==="]"&&Ie(m.target)&&(De(m),m.ctrlKey?se(10):se(1))},se=m=>{if(D){for(let G=0;G<m;G++)D.update(1e3/60);i||_.app.render()}};function Ee(){c=this.checked,t(0,c)}function ee(){W=re(this.value),t(2,W)}function He(){W=re(this.value),t(2,W)}function Te(){b=re(this.value),t(1,b)}function te(){b=re(this.value),t(1,b)}function Ue(){k=re(this.value),t(3,k)}function be(){k=re(this.value),t(3,k)}const ne=()=>y.toggle(),Ce=()=>se(1),We=()=>se(10),Pe=()=>se(100);return l.$$set=m=>{"data"in m&&t(22,p=m.data),"$$scope"in m&&t(25,u=m.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&16777216&&t(9,{width:s,height:n}=r,s,(t(10,n),t(24,r))),l.$$.dirty[0]&8388608&&t(12,{running:i}=o,i),l.$$.dirty[0]&4194304&&w(p),l.$$.dirty[0]&257&&D&&t(8,D.freezeCamera=c,D),l.$$.dirty[0]&258&&D&&t(8,D.player.speed=b,D),l.$$.dirty[0]&260&&D&&t(8,D.player.strength=W,D),l.$$.dirty[0]&264&&D&&t(8,D.timeDilation=k,D),l.$$.dirty[0]&1777)if(c){t(4,U=s),t(5,I=n);const m=E.width,G=E.height,_e=m/U,j=G/I;j>1&&j>_e?(t(7,P=G),t(6,B=U*j|0)):_e>1?(t(6,B=m),t(7,P=I*_e|0)):(t(6,B=U),t(7,P=I))}else{t(6,B=E.width),t(7,P=E.height);const m=B/P,G=s/n;t(4,U=s*Math.min(1,m/G)|0),t(5,I=n*Math.min(1,G/m)|0)}},[c,b,W,k,U,I,B,P,D,s,n,Q,i,g,y,C,v,L,F,ge,$,se,p,o,r,u,a,Ee,ee,He,Te,te,Ue,be,ne,Ce,We,Pe]}class bl extends Ne{constructor(e){super(),Re(this,e,gl,_l,Se,{data:22},null,[-1,-1])}}function ct(l,e,t){const s=l.slice();return s[4]=e[t],s[6]=t,s}const kl=l=>({item:l&2,selected:l&3,index:l&2}),ut=l=>({item:l[4],selected:l[6]===l[0],index:l[6]});function ft(l,e){let t,s;const n=e[3].default,i=gt(n,e,e[2],ut);return{key:l,first:null,c(){t=ue(),i&&i.c(),this.h()},l(o){t=ue(),i&&i.l(o),this.h()},h(){this.first=t},m(o,r){A(o,t,r),i&&i.m(o,r),s=!0},p(o,r){e=o,i&&i.p&&(!s||r&7)&&bt(i,n,e,e[2],s?wt(n,e[2],r,kl):kt(e[2]),ut)},i(o){s||(M(i,o),s=!0)},o(o){X(i,o),s=!1},d(o){o&&S(t),i&&i.d(o)}}}function wl(l){let e=[],t=new Map,s,n,i=tt(l[1]);const o=r=>r[4]||Symbol();for(let r=0;r<i.length;r+=1){let a=ct(l,i,r),u=o(a);t.set(u,e[r]=ft(u,a))}return{c(){for(let r=0;r<e.length;r+=1)e[r].c();s=ue()},l(r){for(let a=0;a<e.length;a+=1)e[a].l(r);s=ue()},m(r,a){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(r,a);A(r,s,a),n=!0},p(r,[a]){a&7&&(i=tt(r[1]),we(),e=Gt(e,a,o,1,r,i,t,s.parentNode,qt,ft,s,ct),ve())},i(r){if(!n){for(let a=0;a<i.length;a+=1)M(e[a]);n=!0}},o(r){for(let a=0;a<e.length;a+=1)X(e[a]);n=!1},d(r){r&&S(s);for(let a=0;a<e.length;a+=1)e[a].d(r)}}}function vl(l,e,t){let{$$slots:s={},$$scope:n}=e,{selectedIndex:i}=e,{items:o}=e;return l.$$set=r=>{"selectedIndex"in r&&t(0,i=r.selectedIndex),"items"in r&&t(1,o=r.items),"$$scope"in r&&t(2,n=r.$$scope)},[i,o,n,s]}class Sl extends Ne{constructor(e){super(),Re(this,e,vl,wl,Se,{selectedIndex:0,items:1})}}function yl(l){let e,t="<td><code>[Space]</code></td><td>reset simulation</td>",s,n="<td><code>[ctrl+S]</code></td><td>save to local storage</td>";return{c(){e=N("tr"),e.innerHTML=t,s=N("tr"),s.innerHTML=n},l(i){e=R(i,"TR",{"data-svelte-h":!0}),ie(e)!=="svelte-16qro8p"&&(e.innerHTML=t),s=R(i,"TR",{"data-svelte-h":!0}),ie(s)!=="svelte-1tf7cdn"&&(s.innerHTML=n)},m(i,o){A(i,e,o),A(i,s,o)},p:ye,d(i){i&&(S(e),S(s))}}}function El(l){let e,t;return e=new jt({props:{clock:l[0],$$slots:{default:[yl]},$$scope:{ctx:l}}}),{c(){fe(e.$$.fragment)},l(s){de(e.$$.fragment,s)},m(s,n){me(e,s,n),t=!0},p(s,[n]){const i={};n&1&&(i.clock=s[0]),n&2&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(M(e.$$.fragment,s),t=!0)},o(s){X(e.$$.fragment,s),t=!1},d(s){he(e,s)}}}function Tl(l,e,t){let{clock:s}=e;return l.$$set=n=>{"clock"in n&&t(0,s=n.clock)},[s]}class Cl extends Ne{constructor(e){super(),Re(this,e,Tl,El,Se,{clock:0})}}function dt(l){let e,t="âœ•",s,n,i,o,r,a;function u(g){l[12](g)}let p={items:l[1],$$slots:{default:[Dl,({selected:g,index:y})=>({17:g,18:y}),({selected:g,index:y})=>(g?131072:0)|(y?262144:0)]},$$scope:{ctx:l}};return l[0]!==void 0&&(p.selectedIndex=l[0]),n=new Sl({props:p}),Nt.push(()=>Wt(n,"selectedIndex",u)),{c(){e=N("button"),e.textContent=t,s=K(),fe(n.$$.fragment),this.h()},l(g){e=R(g,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-1w2wjzv"&&(e.textContent=t),s=V(g),de(n.$$.fragment,g),this.h()},h(){f(e,"title","delete data item"),f(e,"class","svelte-95kbus")},m(g,y){A(g,e,y),A(g,s,y),me(n,g,y),o=!0,r||(a=Y(e,"click",l[10]),r=!0)},p(g,y){const _={};y&2&&(_.items=g[1]),y&917504&&(_.$$scope={dirty:y,ctx:g}),!i&&y&1&&(i=!0,_.selectedIndex=g[0],Rt(()=>i=!1)),n.$set(_)},i(g){o||(M(n.$$.fragment,g),o=!0)},o(g){X(n.$$.fragment,g),o=!1},d(g){g&&(S(e),S(s)),he(n,g),r=!1,a()}}}function Dl(l){let e,t=l[18]+1+"",s,n,i,o;function r(){return l[11](l[18])}return{c(){e=N("button"),s=ae(t),this.h()},l(a){e=R(a,"BUTTON",{class:!0});var u=q(e);s=ce(u,t),u.forEach(S),this.h()},h(){e.disabled=n=l[17],f(e,"class","svelte-95kbus"),et(e,"selected",l[17])},m(a,u){A(a,e,u),T(e,s),i||(o=Y(e,"click",function(){Ht(l[17]?void 0:r)&&(l[17]?void 0:r).apply(this,arguments)}),i=!0)},p(a,u){l=a,u&262144&&t!==(t=l[18]+1+"")&&Ut(s,t),u&131072&&n!==(n=l[17])&&(e.disabled=n),u&131072&&et(e,"selected",l[17])},d(a){a&&S(e),i=!1,o()}}}function mt(l){let e,t="+",s,n;return{c(){e=N("button"),e.textContent=t,this.h()},l(i){e=R(i,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-dh370g"&&(e.textContent=t),this.h()},h(){f(e,"title","add data item"),f(e,"class","svelte-95kbus")},m(i,o){A(i,e,o),s||(n=Y(e,"click",l[13]),s=!0)},p:ye,d(i){i&&S(e),s=!1,n()}}}function Il(l){let e,t,s,n=l[1].length>=2&&dt(l),i=l[1].length<je&&mt(l);return{c(){e=N("div"),n&&n.c(),t=K(),i&&i.c(),this.h()},l(o){e=R(o,"DIV",{class:!0});var r=q(e);n&&n.l(r),t=V(r),i&&i.l(r),r.forEach(S),this.h()},h(){f(e,"class","controls svelte-95kbus")},m(o,r){A(o,e,r),n&&n.m(e,null),T(e,t),i&&i.m(e,null),s=!0},p(o,r){o[1].length>=2?n?(n.p(o,r),r&2&&M(n,1)):(n=dt(o),n.c(),M(n,1),n.m(e,t)):n&&(we(),X(n,1,1,()=>{n=null}),ve()),o[1].length<je?i?i.p(o,r):(i=mt(o),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i(o){s||(M(n),s=!0)},o(o){X(n),s=!1},d(o){o&&S(e),n&&n.d(),i&&i.d()}}}function Ol(l){let e,t;return e=new Cl({props:{clock:l[3]}}),{c(){fe(e.$$.fragment)},l(s){de(e.$$.fragment,s)},m(s,n){me(e,s,n),t=!0},p:ye,i(s){t||(M(e.$$.fragment,s),t=!0)},o(s){X(e.$$.fragment,s),t=!1},d(s){he(e,s)}}}function Nl(l){let e,t,s,n,i;return t=new bl({props:{data:l[2],$$slots:{default:[Il]},$$scope:{ctx:l}}}),t.$on("save",l[14]),n=new Jt({props:{$$slots:{default:[Ol]},$$scope:{ctx:l}}}),{c(){e=N("div"),fe(t.$$.fragment),s=K(),fe(n.$$.fragment),this.h()},l(o){e=R(o,"DIV",{class:!0});var r=q(e);de(t.$$.fragment,r),r.forEach(S),s=V(o),de(n.$$.fragment,o),this.h()},h(){f(e,"class","unlock-studio svelte-95kbus")},m(o,r){A(o,e,r),me(t,e,null),A(o,s,r),me(n,o,r),i=!0},p(o,[r]){const a={};r&4&&(a.data=o[2]),r&524291&&(a.$$scope={dirty:r,ctx:o}),t.$set(a);const u={};r&524288&&(u.$$scope={dirty:r,ctx:o}),n.$set(u)},i(o){i||(M(t.$$.fragment,o),M(n.$$.fragment,o),i=!0)},o(o){X(t.$$.fragment,o),X(n.$$.fragment,o),i=!1},d(o){o&&(S(e),S(s)),he(t),he(n,o)}}}const ht="unlock_stages",_t="unlock_selected_data_index",pt="unlock_data_count",je=10;function Rl(l,e,t){let s,n;const i=Ze();let o=qe(_t,0),r=qe(pt,0),a=Array.from({length:r});const u=c=>{t(0,o=c)},p=c=>{t(1,a=a.slice(0,c).concat(a.slice(c+1))),o>=a.length&&t(0,o--,o)},g=()=>{p(o)},y=c=>{_(o,c)},_=(c,b)=>{t(1,a=a.slice(0,c).concat(b,a.slice(c+1))),Je(`${ht}_${c}`,b)},E=()=>{a.length>=je||(t(1,a=a.concat(structuredClone(n))),u(a.length-1))},h=()=>g(),H=c=>u(c);function C(c){o=c,t(0,o)}const v=()=>E(),w=c=>y(c.detail);return l.$$.update=()=>{l.$$.dirty&1&&Je(_t,o),l.$$.dirty&1&&t(9,s=`${ht}_${o}`),l.$$.dirty&515&&t(2,n=a[o]||t(1,a[o]=qe(s,structuredClone(yt)),a)),l.$$.dirty&2&&t(8,r=a.length),l.$$.dirty&256&&Je(pt,r)},[o,a,n,i,u,g,y,E,r,s,h,H,C,v,w]}class jl extends Ne{constructor(e){super(),Re(this,e,Rl,Nl,Se,{})}}export{jl as component};
