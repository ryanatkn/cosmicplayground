var Et=Object.defineProperty;var Tt=(l,e,t)=>e in l?Et(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var x=(l,e,t)=>(Tt(l,typeof e!="symbol"?e+"":e,t),t);import{n as Se,e as N,s as K,b as R,l as q,d as S,c as V,m as f,p as $e,i as L,L as Xe,a as ye,D as Ct,v as Dt,r as ue,o as T,J as F,E as Qe,a6 as It,a4 as Ot,T as gt,x as ae,y as ce,g as ie,N as le,Q as re,U as bt,V as kt,W as wt,G as Nt,K as Rt,I as et,F as Ht,A as Ut}from"../chunks/scheduler.B6ZHjePS.js";import{S as Ne,i as Re,c as fe,a as de,m as he,t as Y,b as z,d as me,g as we,e as ve,f as Wt}from"../chunks/index.D8p8-7y1.js";import{g as Ze}from"../chunks/clock.CjzioAVG.js";import{D as vt,a as Pt,W as At,S as Lt,b as Mt,c as Yt,d as Ft,E as pe,u as Xt,e as zt,f as Be}from"../chunks/stage.DbOEQ0e6.js";import{s as De}from"../chunks/dom.COxKB0-J.js";import{g as Kt}from"../chunks/dimensions.DSxfro0U.js";import{e as Ie}from"../chunks/dom.CLnrzRWB.js";import{b as St}from"../chunks/pixi.CGO4fLu2.js";import{g as Vt}from"../chunks/idle.BhfSkCr9.js";import{a as Z}from"../chunks/random.BCioE_zI.js";import{w as Gt}from"../chunks/index.B134a2AU.js";import{e as tt,u as Bt,o as qt}from"../chunks/each.DSKrv-cI.js";import{l as qe,s as Je}from"../chunks/storage.BRfawDas.js";import{A as Jt}from"../chunks/AppDialog.mI_jAHDy.js";import{A as jt}from"../chunks/AppControlsTable.DxU9i6bl.js";const yt={freezeCamera:!1,playerSpeed:.6,playerStrength:vt,timeDilation:Pt};function Qt(l){let e,t,s,n,i;return t=new At({props:{worldWidth:l[5],worldHeight:l[6],viewWidth:l[3],viewHeight:l[4],viewportWidth:l[1],viewportHeight:l[2],stage:l[0],pixi:l[12],domCanvasRenderer:l[10]}}),n=new Lt({props:{controller:l[7]}}),{c(){e=N("div"),fe(t.$$.fragment),s=K(),fe(n.$$.fragment),this.h()},l(o){e=R(o,"DIV",{class:!0});var r=q(e);de(t.$$.fragment,r),r.forEach(S),s=V(o),de(n.$$.fragment,o),this.h()},h(){f(e,"class","view svelte-1fxwwt5"),$e(e,"transform",l[9])},m(o,r){L(o,e,r),he(t,e,null),L(o,s,r),he(n,o,r),i=!0},p(o,[r]){const a={};r&32&&(a.worldWidth=o[5]),r&64&&(a.worldHeight=o[6]),r&8&&(a.viewWidth=o[3]),r&16&&(a.viewHeight=o[4]),r&2&&(a.viewportWidth=o[1]),r&4&&(a.viewportHeight=o[2]),r&1&&(a.stage=o[0]),r&1024&&(a.domCanvasRenderer=o[10]),t.$set(a),r&512&&$e(e,"transform",o[9]);const u={};r&128&&(u.controller=o[7]),n.$set(u)},i(o){i||(Y(t.$$.fragment,o),Y(n.$$.fragment,o),i=!0)},o(o){z(t.$$.fragment,o),z(n.$$.fragment,o),i=!1},d(o){o&&(S(e),S(s)),me(t),me(n,o)}}}const Zt=3e4;function xt(l,e,t){let s,n,i,o=ye,r=()=>(o(),o=Ct(U,d=>t(21,i=d)),U),a,u;l.$$.on_destroy.push(()=>o());let{viewportWidth:p}=e,{viewportHeight:g}=e,{viewWidth:y}=e,{viewHeight:_}=e,{worldWidth:E}=e,{worldHeight:m}=e,{cameraUnlocked:H=!1}=e,{finish:C}=e,{stage:v}=e,{enableDomCanvasRenderer:w=!1}=e;const c=Ze();Xe(l,c,d=>t(18,a=d));const b=St(),W=Vt();Xe(l,W,d=>t(19,u=d));let k,U,I,G=!1;const P=()=>{!G&&v.time>Zt&&(G=!0,C(i))},D=(d,J,M,X)=>{if(d===M&&J===X)return"";const Q=Math.min(d/M,J/X);return`scale3d(${Q}, ${Q}, 1)`};return l.$$set=d=>{"viewportWidth"in d&&t(1,p=d.viewportWidth),"viewportHeight"in d&&t(2,g=d.viewportHeight),"viewWidth"in d&&t(3,y=d.viewWidth),"viewHeight"in d&&t(4,_=d.viewHeight),"worldWidth"in d&&t(5,E=d.worldWidth),"worldHeight"in d&&t(6,m=d.worldHeight),"cameraUnlocked"in d&&t(14,H=d.cameraUnlocked),"finish"in d&&t(15,C=d.finish),"stage"in d&&t(0,v=d.stage),"enableDomCanvasRenderer"in d&&t(16,w=d.enableDomCanvasRenderer)},l.$$.update=()=>{l.$$.dirty&16384&&t(0,v.freezeCamera=!H,v),l.$$.dirty&1&&console.log("UnlockStage.svelte stage",v),l.$$.dirty&65536&&t(10,s=w?new Mt:null),l.$$.dirty&524288&&u&&c.pause(),l.$$.dirty&1&&t(17,{camera:k,scores:U,controller:I}=v,k,r(t(8,U)),(t(7,I),t(0,v),t(1,p),t(2,g),t(3,y),t(4,_),t(5,E),t(6,m),t(14,H))),l.$$.dirty&262145&&P(),l.$$.dirty&147457&&H&&k.setPosition(v.player.x,v.player.y),l.$$.dirty&130&&I&&t(7,I.viewportWidth=p,I),l.$$.dirty&132&&I&&t(7,I.viewportHeight=g,I),l.$$.dirty&136&&I&&t(7,I.viewWidth=y,I),l.$$.dirty&144&&I&&t(7,I.viewHeight=_,I),l.$$.dirty&160&&I&&t(7,I.worldWidth=E,I),l.$$.dirty&192&&I&&t(7,I.worldHeight=m,I),l.$$.dirty&120&&t(9,n=D(y,_,E,m))},[v,p,g,y,_,E,m,I,U,n,s,c,b,W,H,C,w,k,a,u]}class $t extends Ne{constructor(e){super(),Re(this,e,xt,Qt,Se,{viewportWidth:1,viewportHeight:2,viewWidth:3,viewHeight:4,worldWidth:5,worldHeight:6,cameraUnlocked:14,finish:15,stage:0,enableDomCanvasRenderer:16})}}const el=[.833,.76,.72],tl=[.611,1,.7],Ye=[.389,.8,.6],ll=[.12,.16,.5],lt=[0,1,.5],sl="ðŸ¢",Oe=["ðŸ’§","ðŸŒ±","ðŸŒ³","ðŸŒ¿","ðŸŒ²"],nl="ðŸª¨",ol=.6,il=vt*.96,rl=100,Fe=.03,al=.21,cl=100,ke=l=>l*1.4,st=l=>({bonus:l.bonus});class ul extends Yt{constructor(t){super(t);x(this,"finished",!1);x(this,"bonus",0);x(this,"player");x(this,"planet");x(this,"rock");x(this,"moons",new Set);x(this,"moonsArray",[]);x(this,"moonFragments",new Set);x(this,"planetFragments",new Set);x(this,"rockFragments",new Set);x(this,"lastPlayerX",0);x(this,"lastPlayerY",0);x(this,"scores");const{data:s}=t,n=850,i=502;this.freezeCamera||this.camera.setPosition(n,i);const{sim:o,collisions:r,controller:a,moons:u}=this;console.log("setup stage, sim, controller",o,a);const p=this.player=new pe(r.create_circle(n,i,rl));p.text=sl,p.fontSize=ke(p.radius),p.speed=(s==null?void 0:s.playerSpeed)??ol,p.strength=(s==null?void 0:s.playerStrength)??il,p.color=el,this.addEntity(p);const g=1618,y=this.planet=new pe(r.create_circle(-1450+g/2,-1750+g/2,g));y.text=Oe[0],y.textOffsetX=850,y.textOffsetY=1150,y.fontSize=200,y.color=tl,this.addEntity(y);const _=262,E=this.rock=new pe(r.create_circle(2275+_/2,1200+_/2,_));E.speed=al,E.directionX=-1,E.directionY=-.7,E.text=nl,E.fontSize=ke(E.radius),E.color=ll,this.addEntity(E);let m=new pe(r.create_circle(1660,1012,43));m.text=Oe[1],m.fontSize=ke(m.radius),m.speed=Fe,m.color=Ye,this.addEntity(m),u.add(m),m=new pe(r.create_circle(1420,1174,72)),m.text=Oe[2],m.fontSize=ke(m.radius),m.speed=Fe,m.color=Ye,this.addEntity(m),u.add(m),m=new pe(r.create_circle(2010,872,19)),m.text=Oe[3],m.fontSize=ke(m.radius),m.speed=Fe,m.color=Ye,this.addEntity(m),u.add(m),m=new pe(r.create_circle(1870,776,27)),m.text=Oe[4],m.fontSize=ke(m.radius),m.speed=Fe,m.color=Ye,this.addEntity(m),u.add(m),this.moonsArray.push(...u),this.scores=Gt(st(this))}updateScores(){const t=st(this);Ft(t,Dt(this.scores))||this.scores.set(t)}update(t){const s=this.timeDilation*Math.min(Math.max(t,0),cl);super.update(s);const{collisions:n,controller:i,player:o,planet:r,rock:a,moons:u,planetFragments:p,moonFragments:g,rockFragments:y,$camera:_}=this;Xt(i,o,_);let E=null,m=null,H=null,C=!1;this.sim.update(s,(c,b,W)=>{zt(c,b,W);const k=a===c?c:a===b?b:null,U=r===c?c:r===b?b:null,I=u.has(c)?c:u.has(b)?b:null,G=y.has(c)?c:y.has(b)?b:null,P=p.has(c)?c:p.has(b)?b:null,D=g.has(c)?c:g.has(b)?b:null,d=k||G||P||D;if(I&&d){const J=d===k,M=d===D,X=Be(I,n,12);C=!0,(H||(H=[])).push(...X),this.removeEntity(I);for(const Q of X)Q.speed=J?Z(d.speed*1.2,d.speed*2.44):M?Z(d.speed/2,d.speed*2):Z(d.speed/8,d.speed),Q.directionX=J?Z(d.directionX/2,d.directionX*2):M?Z(d.directionX/2,d.directionX*2):Z(-d.directionX/2,d.directionX),Q.directionY=J?Z(d.directionY/2,d.directionY*2):M?Z(d.directionY/2,d.directionY*2):Z(-d.directionY/2,d.directionY),Q.color=lt}else if(k&&U){this.removeEntity(k),this.removeEntity(U);const J=Be(U,n,42);C=!0,(m||(m=[])).push(...J);for(const X of J)X.speed=k.speed*.2*Z(.5,1),X.directionX=Z(-k.directionX/2,k.directionX/2),X.directionY=Z(-k.directionY/2,k.directionY/2),X.color=lt;const M=Be(k,n,210);(E||(E=[])).push(...M);for(const X of M)X.speed=Z(k.speed/2,k.speed*2),X.directionX=Z(-k.directionX*2,k.directionX*.25),X.directionY=Z(-k.directionY*2,k.directionY*.25)}else D&&(U||P||G)&&this.removeEntity(D)},(c,b)=>{const W=c.entity,k=b.entity;if(W.dead||k.dead||W.disableSimulation||k.disableSimulation)return!1;const U=o===W?W:o===k?k:null,I=r===W?W:r===k?k:null,G=u.has(W)?W:u.has(k)?k:null;return!(U&&(I||G))});const{x:v,y:w}=o;if(this.freezeCamera){const c=o.radius+1,b=_.left+c,W=_.right-c;v<b?o.x=b:v>W&&(o.x=W);const k=_.top+c,U=_.bottom-c;w<k?o.y=k:w>U&&(o.y=U)}else(v!==this.lastPlayerX||w!==this.lastPlayerY)&&(this.camera.setPosition(v,w),this.lastPlayerX=v,this.lastPlayerY=w);if(E)for(const c of E)y.add(c),this.addEntity(c);if(m)for(const c of m)p.add(c),this.addEntity(c);if(H)for(const c of H)g.add(c),this.addEntity(c);C&&this.updateScores()}}function nt(l){let e,t,s=l[8]&&ot(l);return{c(){e=N("div"),s&&s.c(),this.h()},l(n){e=R(n,"DIV",{class:!0});var i=q(e);s&&s.l(i),i.forEach(S),this.h()},h(){f(e,"class","stage-data-controls-wrapper svelte-6mhxmn")},m(n,i){L(n,e,i),s&&s.m(e,null),t=!0},p(n,i){n[8]?s?(s.p(n,i),i[0]&256&&Y(s,1)):(s=ot(n),s.c(),Y(s,1),s.m(e,null)):s&&(we(),z(s,1,1,()=>{s=null}),ve())},i(n){t||(Y(s),t=!0)},o(n){z(s),t=!1},d(n){n&&S(e),s&&s.d()}}}function ot(l){let e,t,s,n,i,o,r,a,u,p,g,y,_,E,m,H,C,v,w,c,b,W,k,U,I,G,P,D,d="â®",J,M,X,Q,ge,$,se="â†’",Ee,ee,He="â† ",Te,te,Ue="â‡¶",be,ne,Ce,We;function Pe(O,A){return O[12]?dl:fl}let h=Pe(l),B=h(l);const _e=l[26].default,j=gt(_e,l,l[25],null);return{c(){e=N("div"),t=N("label"),s=N("input"),n=ae(" free camera"),i=K(),o=N("div"),r=N("input"),a=K(),u=N("label"),p=N("input"),g=ae(" player strength"),y=K(),_=N("div"),E=N("input"),m=K(),H=N("label"),C=N("input"),v=ae(" player speed"),w=K(),c=N("div"),b=N("input"),W=K(),k=N("label"),U=N("input"),I=ae(" time dilation"),G=K(),P=N("div"),D=N("button"),D.textContent=d,J=K(),M=N("button"),B.c(),ge=K(),$=N("button"),$.textContent=se,Ee=K(),ee=N("button"),ee.textContent=He,Te=K(),te=N("button"),te.textContent=Ue,be=K(),j&&j.c(),this.h()},l(O){e=R(O,"DIV",{class:!0});var A=q(e);t=R(A,"LABEL",{});var ze=q(t);s=R(ze,"INPUT",{type:!0}),n=ce(ze," free camera"),ze.forEach(S),i=V(A),o=R(A,"DIV",{class:!0});var Ae=q(o);r=R(Ae,"INPUT",{type:!0,min:!0,max:!0,step:!0}),a=V(Ae),u=R(Ae,"LABEL",{});var Ke=q(u);p=R(Ke,"INPUT",{type:!0,step:!0,class:!0}),g=ce(Ke," player strength"),Ke.forEach(S),Ae.forEach(S),y=V(A),_=R(A,"DIV",{class:!0});var Le=q(_);E=R(Le,"INPUT",{type:!0,min:!0,max:!0,step:!0}),m=V(Le),H=R(Le,"LABEL",{});var Ve=q(H);C=R(Ve,"INPUT",{type:!0,step:!0,class:!0}),v=ce(Ve," player speed"),Ve.forEach(S),Le.forEach(S),w=V(A),c=R(A,"DIV",{class:!0});var Me=q(c);b=R(Me,"INPUT",{type:!0,min:!0,max:!0,step:!0}),W=V(Me),k=R(Me,"LABEL",{});var Ge=q(k);U=R(Ge,"INPUT",{type:!0,step:!0,class:!0}),I=ce(Ge," time dilation"),Ge.forEach(S),Me.forEach(S),G=V(A),P=R(A,"DIV",{class:!0});var oe=q(P);D=R(oe,"BUTTON",{title:!0,"aria-label":!0,class:!0,"data-svelte-h":!0}),ie(D)!=="svelte-mo0409"&&(D.textContent=d),J=V(oe),M=R(oe,"BUTTON",{title:!0,"aria-label":!0,class:!0});var xe=q(M);B.l(xe),xe.forEach(S),ge=V(oe),$=R(oe,"BUTTON",{title:!0,"aria-label":!0,class:!0,"data-svelte-h":!0}),ie($)!=="svelte-1slrg40"&&($.textContent=se),Ee=V(oe),ee=R(oe,"BUTTON",{title:!0,"aria-label":!0,class:!0,"data-svelte-h":!0}),ie(ee)!=="svelte-1r87iqa"&&(ee.textContent=He),Te=V(oe),te=R(oe,"BUTTON",{title:!0,"aria-label":!0,class:!0,"data-svelte-h":!0}),ie(te)!=="svelte-17eaxdx"&&(te.textContent=Ue),oe.forEach(S),A.forEach(S),be=V(O),j&&j.l(O),this.h()},h(){f(s,"type","checkbox"),f(r,"type","range"),f(r,"min",0),f(r,"max",10),f(r,"step",.1),f(p,"type","number"),f(p,"step",.1),f(p,"class","svelte-6mhxmn"),f(o,"class","control svelte-6mhxmn"),f(E,"type","range"),f(E,"min",0),f(E,"max",10),f(E,"step",.1),f(C,"type","number"),f(C,"step",.1),f(C,"class","svelte-6mhxmn"),f(_,"class","control svelte-6mhxmn"),f(b,"type","range"),f(b,"min",0),f(b,"max",10),f(b,"step",.1),f(U,"type","number"),f(U,"step",.1),f(U,"class","svelte-6mhxmn"),f(c,"class","control svelte-6mhxmn"),f(D,"title","[Spacebar] Reset the simulation"),f(D,"aria-label","Reset the simulation"),f(D,"class","svelte-6mhxmn"),f(M,"title",X="[Backtick] "+(l[12]?"Pause the simulation":"Play the simulation")),f(M,"aria-label",Q=l[12]?"Pause the simulation":"Play the simulation"),f(M,"class","svelte-6mhxmn"),f($,"title","[]] Simulate 1 tick"),f($,"aria-label","Simulate 1 tick"),f($,"class","svelte-6mhxmn"),f(ee,"title","[ctrl+]] Simulate 10 ticks"),f(ee,"aria-label","Simulate 10 ticks"),f(ee,"class","svelte-6mhxmn"),f(te,"title","[shift+]] Simulate 100 ticks"),f(te,"aria-label","Simulate 100 ticks"),f(te,"class","svelte-6mhxmn"),f(P,"class","buttons svelte-6mhxmn"),f(e,"class","stage-data-controls svelte-6mhxmn")},m(O,A){L(O,e,A),T(e,t),T(t,s),s.checked=l[0],T(t,n),T(e,i),T(e,o),T(o,r),le(r,l[2]),T(o,a),T(o,u),T(u,p),le(p,l[2]),T(u,g),T(e,y),T(e,_),T(_,E),le(E,l[1]),T(_,m),T(_,H),T(H,C),le(C,l[1]),T(H,v),T(e,w),T(e,c),T(c,b),le(b,l[3]),T(c,W),T(c,k),T(k,U),le(U,l[3]),T(k,I),T(e,G),T(e,P),T(P,D),T(P,J),T(P,M),B.m(M,null),T(P,ge),T(P,$),T(P,Ee),T(P,ee),T(P,Te),T(P,te),L(O,be,A),j&&j.m(O,A),ne=!0,Ce||(We=[F(s,"change",l[27]),F(r,"change",l[28]),F(r,"input",l[28]),F(p,"input",l[29]),F(E,"change",l[30]),F(E,"input",l[30]),F(C,"input",l[31]),F(b,"change",l[32]),F(b,"input",l[32]),F(U,"input",l[33]),F(D,"click",l[17]),F(M,"click",l[34]),F($,"click",l[35]),F(ee,"click",l[36]),F(te,"click",l[37])],Ce=!0)},p(O,A){A[0]&1&&(s.checked=O[0]),A[0]&4&&le(r,O[2]),A[0]&4&&re(p.value)!==O[2]&&le(p,O[2]),A[0]&2&&le(E,O[1]),A[0]&2&&re(C.value)!==O[1]&&le(C,O[1]),A[0]&8&&le(b,O[3]),A[0]&8&&re(U.value)!==O[3]&&le(U,O[3]),h!==(h=Pe(O))&&(B.d(1),B=h(O),B&&(B.c(),B.m(M,null))),(!ne||A[0]&4096&&X!==(X="[Backtick] "+(O[12]?"Pause the simulation":"Play the simulation")))&&f(M,"title",X),(!ne||A[0]&4096&&Q!==(Q=O[12]?"Pause the simulation":"Play the simulation"))&&f(M,"aria-label",Q),j&&j.p&&(!ne||A[0]&33554432)&&bt(j,_e,O,O[25],ne?wt(_e,O[25],A,null):kt(O[25]),null)},i(O){ne||(Y(j,O),ne=!0)},o(O){z(j,O),ne=!1},d(O){O&&(S(e),S(be)),B.d(),j&&j.d(O),Ce=!1,Qe(We)}}}function fl(l){let e;return{c(){e=ae("â–¶ï¸")},l(t){e=ce(t,"â–¶ï¸")},m(t,s){L(t,e,s)},d(t){t&&S(e)}}}function dl(l){let e;return{c(){e=ae("â¸")},l(t){e=ce(t,"â¸")},m(t,s){L(t,e,s)},d(t){t&&S(e)}}}function hl(l){let e;return{c(){e=ae("+")},l(t){e=ce(t,"+")},m(t,s){L(t,e,s)},d(t){t&&S(e)}}}function ml(l){let e;return{c(){e=ae("-")},l(t){e=ce(t,"-")},m(t,s){L(t,e,s)},d(t){t&&S(e)}}}function it(l){let e,t="import",s,n,i="save",o,r;return{c(){e=N("button"),e.textContent=t,s=K(),n=N("button"),n.textContent=i,this.h()},l(a){e=R(a,"BUTTON",{title:!0,"data-svelte-h":!0}),ie(e)!=="svelte-1t14zww"&&(e.textContent=t),s=V(a),n=R(a,"BUTTON",{title:!0,"data-svelte-h":!0}),ie(n)!=="svelte-1f9cabs"&&(n.textContent=i),this.h()},h(){f(e,"title","Import JSON data"),f(n,"title","[ctrl+s] Save to localStorage")},m(a,u){L(a,e,u),L(a,s,u),L(a,n,u),o||(r=[F(e,"click",l[16]),F(n,"click",l[15])],o=!0)},p:ye,d(a){a&&(S(e),S(s),S(n)),o=!1,Qe(r)}}}function rt(l){let e=l[8],t,s,n=at(l);return{c(){n.c(),t=ue()},l(i){n.l(i),t=ue()},m(i,o){n.m(i,o),L(i,t,o),s=!0},p(i,o){o[0]&256&&Se(e,e=i[8])?(we(),z(n,1,1,ye),ve(),n=at(i),n.c(),Y(n,1),n.m(t.parentNode,t)):n.p(i,o)},i(i){s||(Y(n),s=!0)},o(i){z(n),s=!1},d(i){i&&S(t),n.d(i)}}}function at(l){let e,t;return e=new $t({props:{viewportWidth:l[9],viewportHeight:l[10],viewWidth:l[4],viewHeight:l[5],worldWidth:l[6],worldHeight:l[7],cameraUnlocked:l[0],stage:l[8],finish:l[18],enableDomCanvasRenderer:pl}}),{c(){fe(e.$$.fragment)},l(s){de(e.$$.fragment,s)},m(s,n){he(e,s,n),t=!0},p(s,n){const i={};n[0]&512&&(i.viewportWidth=s[9]),n[0]&1024&&(i.viewportHeight=s[10]),n[0]&16&&(i.viewWidth=s[4]),n[0]&32&&(i.viewHeight=s[5]),n[0]&64&&(i.worldWidth=s[6]),n[0]&128&&(i.worldHeight=s[7]),n[0]&1&&(i.cameraUnlocked=s[0]),n[0]&256&&(i.stage=s[8]),e.$set(i)},i(s){t||(Y(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){me(e,s)}}}function _l(l){let e,t,s,n,i,o,r,a,u,p,g,y,_=l[11]&&nt(l);function E(w,c){return w[11]?ml:hl}let m=E(l),H=m(l),C=l[11]&&it(l),v=l[8]&&rt(l);return{c(){e=N("div"),_&&_.c(),t=K(),s=N("div"),n=N("button"),H.c(),r=K(),C&&C.c(),a=K(),v&&v.c(),u=ue(),this.h()},l(w){e=R(w,"DIV",{class:!0});var c=q(e);_&&_.l(c),t=V(c),s=R(c,"DIV",{class:!0});var b=q(s);n=R(b,"BUTTON",{"aria-label":!0,title:!0});var W=q(n);H.l(W),W.forEach(S),r=V(b),C&&C.l(b),b.forEach(S),c.forEach(S),a=V(w),v&&v.l(w),u=ue(),this.h()},h(){f(n,"aria-label",i=l[11]?"Hide controls":"Show controls"),f(n,"title",o="[Escape] "+(l[11]?"Hide controls":"Show controls")),f(s,"class","main-controls svelte-6mhxmn"),f(e,"class","controls svelte-6mhxmn")},m(w,c){L(w,e,c),_&&_.m(e,null),T(e,t),T(e,s),T(s,n),H.m(n,null),T(s,r),C&&C.m(s,null),L(w,a,c),v&&v.m(w,c),L(w,u,c),p=!0,g||(y=[F(window,"keydown",l[20]),F(n,"click",l[19])],g=!0)},p(w,c){w[11]?_?(_.p(w,c),c[0]&2048&&Y(_,1)):(_=nt(w),_.c(),Y(_,1),_.m(e,t)):_&&(we(),z(_,1,1,()=>{_=null}),ve()),m!==(m=E(w))&&(H.d(1),H=m(w),H&&(H.c(),H.m(n,null))),(!p||c[0]&2048&&i!==(i=w[11]?"Hide controls":"Show controls"))&&f(n,"aria-label",i),(!p||c[0]&2048&&o!==(o="[Escape] "+(w[11]?"Hide controls":"Show controls")))&&f(n,"title",o),w[11]?C?C.p(w,c):(C=it(w),C.c(),C.m(s,null)):C&&(C.d(1),C=null),w[8]?v?(v.p(w,c),c[0]&256&&Y(v,1)):(v=rt(w),v.c(),Y(v,1),v.m(u.parentNode,u)):v&&(we(),z(v,1,1,()=>{v=null}),ve())},i(w){p||(Y(_),Y(v),p=!0)},o(w){z(_),z(v),p=!1},d(w){w&&(S(e),S(a),S(u)),_&&_.d(),H.d(),C&&C.d(),v&&v.d(w),g=!1,Qe(y)}}}const pl=!1;function gl(l,e,t){let s,n,i,o,r,{$$slots:a={},$$scope:u}=e,{data:p}=e;const g=Kt();Xe(l,g,h=>t(24,r=h));const y=Ze();Xe(l,y,h=>t(23,o=h));const _=St(),E={width:2560,height:1440},m=It();let H=p;Ot(()=>{J()});const C=()=>{D&&(H=D.toData(),m("save",H))},v=()=>{let h=prompt("imported data",JSON.stringify(p));if(h!==null)if(h=h.trim(),h)try{t(22,p=JSON.parse(h))}catch{alert("failed to parse");return}else t(22,p=yt)},w=h=>{console.log("updateFromData",h),H=h,t(0,c=!h.freezeCamera),t(1,b=h.playerSpeed),t(2,W=h.playerStrength),t(3,k=h.timeDilation),J()};let c=!p.freezeCamera,b=p.playerSpeed,W=p.playerStrength,k=p.timeDilation,U,I,G,P,D=null;const d=()=>{D&&(D.destroy(),t(8,D=null))},J=()=>{D&&d(),t(8,D=new ul({exit:h=>console.log("exited stage",h),viewHeight:I,viewWidth:U,viewportHeight:n,viewportWidth:s,worldHeight:P,worldWidth:G,data:H||p}))},M=()=>{J()},X=async()=>{console.log("FINISH"),y.pause()};let Q=!0;const ge=()=>t(11,Q=!Q),$=h=>{h.key==="`"&&h.ctrlKey&&Ie(h.target)?(De(h),ge()):h.key===" "&&!h.ctrlKey&&Ie(h.target)?(De(h),M()):h.key==="s"&&h.ctrlKey&&Ie(h.target)?(De(h),C()):h.key==="}"&&Ie(h.target)?(De(h),se(100)):h.key==="]"&&Ie(h.target)&&(De(h),h.ctrlKey?se(10):se(1))},se=h=>{if(D){for(let B=0;B<h;B++)D.update(1e3/60);i||_.app.render()}};function Ee(){c=this.checked,t(0,c)}function ee(){W=re(this.value),t(2,W)}function He(){W=re(this.value),t(2,W)}function Te(){b=re(this.value),t(1,b)}function te(){b=re(this.value),t(1,b)}function Ue(){k=re(this.value),t(3,k)}function be(){k=re(this.value),t(3,k)}const ne=()=>y.toggle(),Ce=()=>se(1),We=()=>se(10),Pe=()=>se(100);return l.$$set=h=>{"data"in h&&t(22,p=h.data),"$$scope"in h&&t(25,u=h.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&16777216&&t(9,{width:s,height:n}=r,s,(t(10,n),t(24,r))),l.$$.dirty[0]&8388608&&t(12,{running:i}=o,i),l.$$.dirty[0]&4194304&&w(p),l.$$.dirty[0]&257&&D&&t(8,D.freezeCamera=c,D),l.$$.dirty[0]&258&&D&&t(8,D.player.speed=b,D),l.$$.dirty[0]&260&&D&&t(8,D.player.strength=W,D),l.$$.dirty[0]&264&&D&&t(8,D.timeDilation=k,D),l.$$.dirty[0]&1777)if(c){t(4,U=s),t(5,I=n);const h=E.width,B=E.height,_e=h/U,j=B/I;j>1&&j>_e?(t(7,P=B),t(6,G=U*j|0)):_e>1?(t(6,G=h),t(7,P=I*_e|0)):(t(6,G=U),t(7,P=I))}else{t(6,G=E.width),t(7,P=E.height);const h=G/P,B=s/n;t(4,U=s*Math.min(1,h/B)|0),t(5,I=n*Math.min(1,B/h)|0)}},[c,b,W,k,U,I,G,P,D,s,n,Q,i,g,y,C,v,M,X,ge,$,se,p,o,r,u,a,Ee,ee,He,Te,te,Ue,be,ne,Ce,We,Pe]}class bl extends Ne{constructor(e){super(),Re(this,e,gl,_l,Se,{data:22},null,[-1,-1])}}function ct(l,e,t){const s=l.slice();return s[4]=e[t],s[6]=t,s}const kl=l=>({item:l&2,selected:l&3,index:l&2}),ut=l=>({item:l[4],selected:l[6]===l[0],index:l[6]});function ft(l,e){let t,s;const n=e[3].default,i=gt(n,e,e[2],ut);return{key:l,first:null,c(){t=ue(),i&&i.c(),this.h()},l(o){t=ue(),i&&i.l(o),this.h()},h(){this.first=t},m(o,r){L(o,t,r),i&&i.m(o,r),s=!0},p(o,r){e=o,i&&i.p&&(!s||r&7)&&bt(i,n,e,e[2],s?wt(n,e[2],r,kl):kt(e[2]),ut)},i(o){s||(Y(i,o),s=!0)},o(o){z(i,o),s=!1},d(o){o&&S(t),i&&i.d(o)}}}function wl(l){let e=[],t=new Map,s,n,i=tt(l[1]);const o=r=>r[4]||Symbol();for(let r=0;r<i.length;r+=1){let a=ct(l,i,r),u=o(a);t.set(u,e[r]=ft(u,a))}return{c(){for(let r=0;r<e.length;r+=1)e[r].c();s=ue()},l(r){for(let a=0;a<e.length;a+=1)e[a].l(r);s=ue()},m(r,a){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(r,a);L(r,s,a),n=!0},p(r,[a]){a&7&&(i=tt(r[1]),we(),e=Bt(e,a,o,1,r,i,t,s.parentNode,qt,ft,s,ct),ve())},i(r){if(!n){for(let a=0;a<i.length;a+=1)Y(e[a]);n=!0}},o(r){for(let a=0;a<e.length;a+=1)z(e[a]);n=!1},d(r){r&&S(s);for(let a=0;a<e.length;a+=1)e[a].d(r)}}}function vl(l,e,t){let{$$slots:s={},$$scope:n}=e,{selectedIndex:i}=e,{items:o}=e;return l.$$set=r=>{"selectedIndex"in r&&t(0,i=r.selectedIndex),"items"in r&&t(1,o=r.items),"$$scope"in r&&t(2,n=r.$$scope)},[i,o,n,s]}class Sl extends Ne{constructor(e){super(),Re(this,e,vl,wl,Se,{selectedIndex:0,items:1})}}function yl(l){let e,t="<td><code>[Space]</code></td><td>reset simulation</td>",s,n="<td><code>[ctrl+S]</code></td><td>save to local storage</td>";return{c(){e=N("tr"),e.innerHTML=t,s=N("tr"),s.innerHTML=n},l(i){e=R(i,"TR",{"data-svelte-h":!0}),ie(e)!=="svelte-16qro8p"&&(e.innerHTML=t),s=R(i,"TR",{"data-svelte-h":!0}),ie(s)!=="svelte-1tf7cdn"&&(s.innerHTML=n)},m(i,o){L(i,e,o),L(i,s,o)},p:ye,d(i){i&&(S(e),S(s))}}}function El(l){let e,t;return e=new jt({props:{clock:l[0],$$slots:{default:[yl]},$$scope:{ctx:l}}}),{c(){fe(e.$$.fragment)},l(s){de(e.$$.fragment,s)},m(s,n){he(e,s,n),t=!0},p(s,[n]){const i={};n&1&&(i.clock=s[0]),n&2&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(Y(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){me(e,s)}}}function Tl(l,e,t){let{clock:s}=e;return l.$$set=n=>{"clock"in n&&t(0,s=n.clock)},[s]}class Cl extends Ne{constructor(e){super(),Re(this,e,Tl,El,Se,{clock:0})}}function dt(l){let e,t="âœ•",s,n,i,o,r,a;function u(g){l[12](g)}let p={items:l[1],$$slots:{default:[Dl,({selected:g,index:y})=>({17:g,18:y}),({selected:g,index:y})=>(g?131072:0)|(y?262144:0)]},$$scope:{ctx:l}};return l[0]!==void 0&&(p.selectedIndex=l[0]),n=new Sl({props:p}),Nt.push(()=>Wt(n,"selectedIndex",u)),{c(){e=N("button"),e.textContent=t,s=K(),fe(n.$$.fragment),this.h()},l(g){e=R(g,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-1w2wjzv"&&(e.textContent=t),s=V(g),de(n.$$.fragment,g),this.h()},h(){f(e,"title","delete data item"),f(e,"class","svelte-1k7cwmk")},m(g,y){L(g,e,y),L(g,s,y),he(n,g,y),o=!0,r||(a=F(e,"click",l[10]),r=!0)},p(g,y){const _={};y&2&&(_.items=g[1]),y&917504&&(_.$$scope={dirty:y,ctx:g}),!i&&y&1&&(i=!0,_.selectedIndex=g[0],Rt(()=>i=!1)),n.$set(_)},i(g){o||(Y(n.$$.fragment,g),o=!0)},o(g){z(n.$$.fragment,g),o=!1},d(g){g&&(S(e),S(s)),me(n,g),r=!1,a()}}}function Dl(l){let e,t=l[18]+1+"",s,n,i,o;function r(){return l[11](l[18])}return{c(){e=N("button"),s=ae(t),this.h()},l(a){e=R(a,"BUTTON",{class:!0});var u=q(e);s=ce(u,t),u.forEach(S),this.h()},h(){e.disabled=n=l[17],f(e,"class","svelte-1k7cwmk"),et(e,"selected",l[17])},m(a,u){L(a,e,u),T(e,s),i||(o=F(e,"click",function(){Ht(l[17]?void 0:r)&&(l[17]?void 0:r).apply(this,arguments)}),i=!0)},p(a,u){l=a,u&262144&&t!==(t=l[18]+1+"")&&Ut(s,t),u&131072&&n!==(n=l[17])&&(e.disabled=n),u&131072&&et(e,"selected",l[17])},d(a){a&&S(e),i=!1,o()}}}function ht(l){let e,t="+",s,n;return{c(){e=N("button"),e.textContent=t,this.h()},l(i){e=R(i,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-dh370g"&&(e.textContent=t),this.h()},h(){f(e,"title","add data item"),f(e,"class","svelte-1k7cwmk")},m(i,o){L(i,e,o),s||(n=F(e,"click",l[13]),s=!0)},p:ye,d(i){i&&S(e),s=!1,n()}}}function Il(l){let e,t,s,n=l[1].length>=2&&dt(l),i=l[1].length<je&&ht(l);return{c(){e=N("div"),n&&n.c(),t=K(),i&&i.c(),this.h()},l(o){e=R(o,"DIV",{class:!0});var r=q(e);n&&n.l(r),t=V(r),i&&i.l(r),r.forEach(S),this.h()},h(){f(e,"class","controls svelte-1k7cwmk")},m(o,r){L(o,e,r),n&&n.m(e,null),T(e,t),i&&i.m(e,null),s=!0},p(o,r){o[1].length>=2?n?(n.p(o,r),r&2&&Y(n,1)):(n=dt(o),n.c(),Y(n,1),n.m(e,t)):n&&(we(),z(n,1,1,()=>{n=null}),ve()),o[1].length<je?i?i.p(o,r):(i=ht(o),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i(o){s||(Y(n),s=!0)},o(o){z(n),s=!1},d(o){o&&S(e),n&&n.d(),i&&i.d()}}}function Ol(l){let e,t;return e=new Cl({props:{clock:l[3]}}),{c(){fe(e.$$.fragment)},l(s){de(e.$$.fragment,s)},m(s,n){he(e,s,n),t=!0},p:ye,i(s){t||(Y(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){me(e,s)}}}function Nl(l){let e,t,s,n,i;return t=new bl({props:{data:l[2],$$slots:{default:[Il]},$$scope:{ctx:l}}}),t.$on("save",l[14]),n=new Jt({props:{$$slots:{default:[Ol]},$$scope:{ctx:l}}}),{c(){e=N("div"),fe(t.$$.fragment),s=K(),fe(n.$$.fragment),this.h()},l(o){e=R(o,"DIV",{class:!0});var r=q(e);de(t.$$.fragment,r),r.forEach(S),s=V(o),de(n.$$.fragment,o),this.h()},h(){f(e,"class","unlock-studio svelte-1k7cwmk")},m(o,r){L(o,e,r),he(t,e,null),L(o,s,r),he(n,o,r),i=!0},p(o,[r]){const a={};r&4&&(a.data=o[2]),r&524291&&(a.$$scope={dirty:r,ctx:o}),t.$set(a);const u={};r&524288&&(u.$$scope={dirty:r,ctx:o}),n.$set(u)},i(o){i||(Y(t.$$.fragment,o),Y(n.$$.fragment,o),i=!0)},o(o){z(t.$$.fragment,o),z(n.$$.fragment,o),i=!1},d(o){o&&(S(e),S(s)),me(t),me(n,o)}}}const mt="unlock_stages",_t="unlock_selected_data_index",pt="unlock_data_count",je=10;function Rl(l,e,t){let s,n;const i=Ze();let o=qe(_t,0),r=qe(pt,0),a=Array.from({length:r});const u=c=>{t(0,o=c)},p=c=>{t(1,a=a.slice(0,c).concat(a.slice(c+1))),o>=a.length&&t(0,o--,o)},g=()=>{p(o)},y=c=>{_(o,c)},_=(c,b)=>{t(1,a=a.slice(0,c).concat(b,a.slice(c+1))),Je(`${mt}_${c}`,b)},E=()=>{a.length>=je||(t(1,a=a.concat(structuredClone(n))),u(a.length-1))},m=()=>g(),H=c=>u(c);function C(c){o=c,t(0,o)}const v=()=>E(),w=c=>y(c.detail);return l.$$.update=()=>{l.$$.dirty&1&&Je(_t,o),l.$$.dirty&1&&t(9,s=`${mt}_${o}`),l.$$.dirty&515&&t(2,n=a[o]||t(1,a[o]=qe(s,structuredClone(yt)),a)),l.$$.dirty&2&&t(8,r=a.length),l.$$.dirty&256&&Je(pt,r)},[o,a,n,i,u,g,y,E,r,s,m,H,C,v,w]}class Jl extends Ne{constructor(e){super(),Re(this,e,Rl,Nl,Se,{})}}export{Jl as component};
